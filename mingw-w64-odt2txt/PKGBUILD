# Maintainer: Alberto Fanjul <albertofanjul@gmail.com>

_realname=odt2txt
pkgbase=mingw-w64-${_realname}
pkgname="${MINGW_PACKAGE_PREFIX}-${_realname}"
pkgver=0.5
pkgrel=1
pkgdesc="extracts the text out of OpenDocument Texts"
url="https://github.com/dstosberg/odt2txt/"
license=("GPL2")
arch=('any')
depends=('zlib-devel' 'libiconv-devel' "mingw-w64-${CARCH}-libzip" "mingw-w64-${CARCH}-pcre")
source=("https://github.com/dstosberg/odt2txt/archive/v0.5.tar.gz" "0001-Compile-for-Msys2.patch")
sha256sums=('23a889109ca9087a719c638758f14cc3b867a5dcf30a6c90bf6a0985073556dd' '14372a3856656ffd5a497560a7b410cdbbf9fdcaf241b7233bbd8f439b93a006') 

prepare() {
  cd "$srcdir/${_realname}-$pkgver"
  patch -p1 -i "$srcdir/0001-Compile-for-Msys2.patch"
}

build() {
  [[ "$CARCH" == "x86_64" ]] && arch_make=64
  [[ "$CARCH" == "i686" ]] && arch_make=32

  cd "$srcdir/${_realname}-$pkgver"
  make ARCH=${arch_make}
}

package() {
  cd "$srcdir/${_realname}-$pkgver"

  mkdir -p "$pkgdir"/usr/bin
  cp odt2txt.exe "$pkgdir"/usr/bin/odt2txt.exe
  mkdir -p "$pkgdir"/usr/share/man/man1
  cp odt2txt.1 "$pkgdir"/usr/share/man/man1/odt2txt.1
}

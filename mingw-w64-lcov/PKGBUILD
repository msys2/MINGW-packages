# Contributor: Jordi De Groof <jordi dot degroof at gmail dot com>
# Contributor: Andre Klitzing <aklitzing () gmail () com>
# Contributor: Simon Sobisch <simonsobisch () gnu () org>

_realname=lcov
pkgbase=mingw-w64-${_realname}
pkgname=("${MINGW_PACKAGE_PREFIX}-${_realname}")
pkgver=2.2
pkgrel=0
pkgdesc="front-end for GCC's coverage testing tool gcov"
arch=('any')
mingw_arch=('mingw64' 'ucrt64' 'clang64' 'clangarm64')
url="https://github.com/linux-test-project/lcov"
license=('spdx:GPL-2.0-or-later')
depends=("${MINGW_PACKAGE_PREFIX}-perl")
source=("https://github.com/linux-test-project/lcov/releases/download/v${pkgver}/${_realname}-${pkgver}.tar.gz"
        "003-mingw-lcov-win32.patch")
sha256sums=('caf5be723aa9ffe7bb7b0e52be7155e8953949fbf96586d088ebf3de6a9db0d0'
            '5b7b0c0f62676d3bb720a0f1ef05e7076b4c4d589469e9aa6c2fcfa3629000bf')

prepare() {
  cd "${srcdir}/${_realname}-${pkgver}"

  # ignore for now - all but _possibly_ dir_separator part
  # are already solved upstream - TODO: check result
  # patch -p1 -i "${srcdir}"/003-mingw-lcov-win32.patch
}

package() {
  cd "${srcdir}/${_realname}-${pkgver}"

  make LCOV_PERL_PATH="${MINGW_PREFIX}/bin/perl" PREFIX="${MINGW_PREFIX}" DESTDIR="${pkgdir}" install
}

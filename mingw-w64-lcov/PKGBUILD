# Contributor: Jordi De Groof <jordi dot degroof at gmail dot com>
# Contributor: Andre Klitzing <aklitzing () gmail () com>

_realname=lcov
pkgbase=mingw-w64-${_realname}
pkgname=("${MINGW_PACKAGE_PREFIX}-${_realname}")
pkgver=1.13
pkgrel=1
pkgdesc="front-end for GCC's coverage testing tool gcov"
arch=('any')
url="https://ltp.sourceforge.io/coverage/lcov.php"
license=('GPL')
depends=("${MINGW_PACKAGE_PREFIX}-perl")
source=("https://downloads.sourceforge.net/ltp/$_realname-$pkgver.tar.gz"
        "handle-equals-signs.patch"
        "fix-undef-behaviour.patch"
        "reproducible-manpage.patch"
        "fix-mingw-install-path.patch"
        )


# Helper macros to help make tasks easier #
apply_patch_with_msg() {
  for _patch in "$@"
  do
    msg2 "Applying $_patch"
    patch -Nbp1 -i "${srcdir}/$_patch"
  done
}

del_file_exists() {
  for _fname in "$@"
  do
    if [ -f $_fname ]; then
      rm -rf $_fname
    fi
  done
}
# =========================================== #


prepare()
{
  cd "$srcdir/$_realname-$pkgver"
  apply_patch_with_msg handle-equals-signs.patch \
    fix-undef-behaviour.patch 
#    reproducible-manpage.patch \
#    apply_patch_with_msg fix-mingw-install-path.patch
}

package()
{
 cd "$srcdir/$_realname-$pkgver"

 make PREFIX="${pkgdir}/${MINGW_PREFIX}" install
}

sha256sums=('44972c878482cc06a05fe78eaa3645cbfcbad6634615c3309858b207965d8a23'
            '54728aa4e244d3662c65ba91fb486dc1d5c64d9d55745ee334c4131109dc233c'
            'ceaf41f7cc9cea5a6fc4b0385ffef10d1ab8812acd2a5b16dcd8d7bca7120488'
            'd854c999a70ec8ac3e32419ece6acd62ad5517a7521a00dc1e5c79e9495c9af2'
            '50903383cfe7538a4ce8a7f652f9f00cf4bf76f25438bb8c6821f479a57ae904')

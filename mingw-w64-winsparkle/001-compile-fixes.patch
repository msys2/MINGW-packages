diff -urN winsparkle-0.7.0-orig/include/winsparkle.h winsparkle-0.7.0/include/winsparkle.h
--- winsparkle-0.7.0-orig/include/winsparkle.h	2020-06-07 16:50:21.000000000 +0800
+++ winsparkle-0.7.0/include/winsparkle.h	2022-01-03 20:51:14.124155600 +0800
@@ -27,6 +27,7 @@
 #define _winsparkle_h_
 
 #include <stddef.h>
+#include <time.h>
 
 #include "winsparkle-version.h"
 
@@ -38,11 +39,15 @@
 extern "C" {
 #endif
 
+#ifdef DLL_EXPORT
 #ifdef BUILDING_WIN_SPARKLE
     #define WIN_SPARKLE_API __declspec(dllexport)
 #else
     #define WIN_SPARKLE_API __declspec(dllimport)
 #endif
+#else
+    #define WIN_SPARKLE_API
+#endif
 
 /*--------------------------------------------------------------------------*
                        Initialization and shutdown
diff -urN winsparkle-0.7.0-orig/src/Makefile winsparkle-0.7.0/src/Makefile
--- winsparkle-0.7.0-orig/src/Makefile	1970-01-01 07:30:00.000000000 +0730
+++ winsparkle-0.7.0/src/Makefile	2022-01-03 20:36:00.265885900 +0800
@@ -0,0 +1,47 @@
+# GCC makefile for WinSparkle
+# Copyright (C) 2015, 2016 Renato Silva
+# This file is licensed under the same terms as WinSparkle
+
+AR  = ar
+WINDRES  = windres
+
+CXXFLAGS = -std=c++14 -D_WIN32_WINNT=0x601 -DUNICODE -D_UNICODE -DBUILDING_WIN_SPARKLE
+CPPFLAGS = -I../include $(shell wx-config --cflags)
+LDFLAGS  = -Wl,--export-all-symbols
+
+STATICLIB = libwinsparkle.a
+SHAREDLIB = libwinsparkle.dll.a
+DLLNAME   = libwinsparkle.dll
+
+WX_LIBS = $(shell wx-config --libs core)
+SSL_LIBS = -lcrypto -lssl -lcrypt32
+LIBS = -lexpat -luuid -lwininet -lrpcrt4 -lversion -lole32 -loleaut32
+
+all: ${STATICLIB} ${SHAREDLIB}
+
+OBJS =	appcast.o \
+	appcontroller.o \
+	dll_api.o \
+	dllmain.o \
+	download.o \
+	error.o \
+	settings.o \
+	signatureverifier.o \
+	threads.o \
+	ui.o \
+	updatechecker.o \
+	updatedownloader.o
+
+RESFILE = winsparkle.res
+
+${OBJS}: %.o: %.cpp
+	${CXX} ${CXXFLAGS} ${CPPFLAGS} -c $< -o $@
+
+${RESFILE}: winsparkle.rc
+	${WINDRES} -I../include winsparkle.rc -O coff -o $@
+
+${STATICLIB}: ${OBJS}
+	${AR} rcs $@ ${OBJS}
+
+${SHAREDLIB}: ${OBJS} ${RESFILE}
+	${CXX} -shared -o ${DLLNAME} ${OBJS} ${RESFILE} -Wl,--out-implib,$@ ${LDFLAGS} ${WX_LIBS} ${SSL_LIBS} ${LIBS}
diff -urN winsparkle-0.7.0-orig/src/error.h winsparkle-0.7.0/src/error.h
--- winsparkle-0.7.0-orig/src/error.h	2020-06-07 16:50:21.000000000 +0800
+++ winsparkle-0.7.0/src/error.h	2021-11-04 19:13:44.821769700 +0800
@@ -27,6 +27,7 @@
 #define _error_h_
 
 #include <stdexcept>
+#include <string>
 
 namespace winsparkle
 {
diff -urN winsparkle-0.7.0-orig/src/ui.cpp winsparkle-0.7.0/src/ui.cpp
--- winsparkle-0.7.0-orig/src/ui.cpp	2020-06-07 16:50:21.000000000 +0800
+++ winsparkle-0.7.0/src/ui.cpp	2021-11-04 20:20:30.095858300 +0800
@@ -1070,7 +1070,7 @@
                 VARIANT *param;
                 SafeArrayAccessData(psaStrings, (LPVOID*) &param);
                 param->vt = VT_BSTR;
-                param->bstrVal = wxBasicString(wxString::FromUTF8(info.Description.c_str())).Detach();
+                param->bstrVal = wxBasicString(wxString::FromUTF8(info.Description.c_str()));
                 SafeArrayUnaccessData(psaStrings);
 
                 doc->write(psaStrings);

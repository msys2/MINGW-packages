From d34fb77c64fb182f91dca389e8b19b1a6ea6d612 Mon Sep 17 00:00:00 2001
From: Tim Stahlhut <stahta01@gmail.com>
Date: Wed, 12 Jun 2019 17:31:22 -0400
Subject: [PATCH] Remove Posix.nl_langinfo usage

---
 lib/math-equation.vala               |  4 +---
 lib/serializer.vala                  | 23 +++--------------------
 search-provider/search-provider.vala |  8 ++------
 src/gcalccmd.vala                    |  8 ++------
 src/gnome-calculator.vala            |  8 ++------
 5 files changed, 10 insertions(+), 41 deletions(-)

diff --git a/lib/math-equation.vala b/lib/math-equation.vala
index d2c3e620..72f0428e 100644
--- a/lib/math-equation.vala
+++ b/lib/math-equation.vala
@@ -495,9 +495,7 @@ public class MathEquation : Gtk.SourceBuffer
             get_bounds (out start, out end);
 
         var text = get_text (start, end, false);
-        var tsep_string = Posix.nl_langinfo (Posix.NLItem.THOUSEP);
-        if (tsep_string == null || tsep_string == "")
-            tsep_string = " ";
+        var tsep_string = " ";
         text = text.replace (tsep_string, "");
         Gtk.Clipboard.get (Gdk.Atom.NONE).set_text (text, -1);
     }
diff --git a/lib/serializer.vala b/lib/serializer.vala
index 21bfee4b..dab63d00 100644
--- a/lib/serializer.vala
+++ b/lib/serializer.vala
@@ -37,26 +37,9 @@ public class Serializer : Object
 
     public Serializer (DisplayFormat format, int number_base, int trailing_digits)
     {
-        var radix_string = Posix.nl_langinfo (Posix.NLItem.RADIXCHAR);
-        if (radix_string != null && radix_string != "") {
-            var radix_utf8 = radix_string.locale_to_utf8 (-1, null, null);
-            if (radix_utf8 != null)
-                radix = radix_utf8.get_char (0);
-            else
-                radix = '.';
-        }
-        else
-            radix = '.';
-        var tsep_string = Posix.nl_langinfo (Posix.NLItem.THOUSEP);
-        if (tsep_string != null && tsep_string != "") {
-            var tsep_utf8 = tsep_string.locale_to_utf8 (-1, null, null);
-            if (tsep_utf8 != null)
-                tsep = tsep_utf8.get_char (0);
-            else
-                tsep = ' ';
-        }
-        else
-            tsep = ' ';
+        radix = '.';
+
+        tsep = ' ';
         tsep_count = 3;
 
         this.number_base = number_base;
diff --git a/search-provider/search-provider.vala b/search-provider/search-provider.vala
index 7aa5f44f..3b94027b 100644
--- a/search-provider/search-provider.vala
+++ b/search-provider/search-provider.vala
@@ -87,13 +87,9 @@ public class SearchProvider : Object
 
         cancel();
 
-        var tsep_string = Posix.nl_langinfo (Posix.NLItem.THOUSEP);
-        if (tsep_string == null || tsep_string == "")
-        tsep_string = " ";
+        var tsep_string = " ";
 
-        var decimal = Posix.nl_langinfo (Posix.NLItem.RADIXCHAR);
-        if (decimal == null)
-        decimal = "";
+        var decimal = "";
 
         // "normalize" input to a format known to double.try_parse
         var normalized_equation = equation.replace (tsep_string, "").replace (decimal, ".");
diff --git a/src/gcalccmd.vala b/src/gcalccmd.vala
index 3bf6c45e..a07058f0 100644
--- a/src/gcalccmd.vala
+++ b/src/gcalccmd.vala
@@ -15,13 +15,9 @@ private static Serializer result_serializer;
 
 static void solve (string equation)
 {
-    var tsep_string = Posix.nl_langinfo (Posix.NLItem.THOUSEP);
-    if (tsep_string == null || tsep_string == "")
-        tsep_string = " ";
+    var tsep_string = " ";
 
-    var decimal = Posix.nl_langinfo (Posix.NLItem.RADIXCHAR);
-    if (decimal == null)
-        decimal = "";
+    var decimal = "";
 
     string? error_token = null;
     var e = new Equation (equation.replace (tsep_string, "").replace (decimal, "."));
diff --git a/src/gnome-calculator.vala b/src/gnome-calculator.vala
index 60b072d8..b846fab1 100644
--- a/src/gnome-calculator.vala
+++ b/src/gnome-calculator.vala
@@ -204,13 +204,9 @@ public class Calculator : Gtk.Application
         if (options.contains ("solve"))
         {
             var solve_equation = (string) options.lookup_value ("solve", VariantType.STRING);
-            var tsep_string = Posix.nl_langinfo (Posix.NLItem.THOUSEP);
-            if (tsep_string == null || tsep_string == "")
-                tsep_string = " ";
+            var tsep_string = " ";
 
-            var decimal = Posix.nl_langinfo (Posix.NLItem.RADIXCHAR);
-            if (decimal == null)
-                decimal = "";
+            var decimal = "";
 
             settings = new Settings ("org.gnome.calculator");
             var angle_units = (AngleUnit) settings.get_enum ("angle-units");
-- 
2.22.0.windows.1


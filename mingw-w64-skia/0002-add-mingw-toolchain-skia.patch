--- skia/BUILD.gn.orig	2025-12-02 16:28:52.000000000 +0100
+++ skia/BUILD.gn	2026-01-17 15:09:09.134566000 +0100
@@ -165,7 +165,7 @@
 opts("hsw") {
   enabled = is_x86
   sources = skia_opts.hsw_sources
-  if (is_win) {
+  if (is_msvc) {
     cflags = [ "/arch:AVX2" ]
   } else {
     cflags = [ "-march=haswell" ]
@@ -175,7 +175,7 @@
 opts("skx") {
   enabled = is_x86
   sources = skia_opts.skx_sources
-  if (is_win) {
+  if (is_msvc) {
     cflags = [ "/arch:AVX512" ]
   } else {
     cflags = [ "-march=skylake-avx512" ]
@@ -463,7 +463,7 @@
   sources = skia_ports_windows_fonts_sources
   if (skia_dwritecore_sdk != "") {
     defines = [ "DWRITE_CORE" ]
-    if (is_win && is_clang) {
+    if (is_msvc && is_clang) {
       # Clang complains about these headers, so mark them as system. These
       # headers are hiding SDK headers of the same name, which are also
       # included as system headers, so these need to go first in the cflags
@@ -484,7 +484,7 @@
   public_defines = [ "SK_FONTMGR_GDI_AVAILABLE" ]
   public = skia_ports_windows_fonts_public
   sources = skia_ports_fonthost_win_sources
-  libs = [ "Gdi32.lib" ]
+  libs = [ "gdi32" ]
 }
 
 if (skia_lex) {
@@ -1011,7 +1011,7 @@
         "src/gpu/ganesh/gl/win/GrGLMakeWinInterface.cpp",
       ]
       if (target_cpu != "arm64") {
-        libs += [ "OpenGL32.lib" ]
+        libs += [ "opengl32" ]
       }
     } else {
       sources += [ "src/gpu/ganesh/gl/GrGLMakeNativeInterface_none.cpp" ]
@@ -1037,9 +1037,9 @@
       public_defines += [ "SK_ENABLE_D3D_DEBUG_LAYER" ]
     }
     libs += [
-      "d3d12.lib",
-      "dxgi.lib",
-      "d3dcompiler.lib",
+      "d3d12",
+      "dxgi",
+      "d3dcompiler",
     ]
   }
 
@@ -1758,15 +1758,16 @@
                  "src/ports/SkImageGeneratorWIC.cpp",
                ]
     libs += [
-      "Ole32.lib",
-      "OleAut32.lib",
+      "ole32",
+      "oleaut32",
+      "uuid",
     ]
 
     if (!skia_enable_winuwp) {
       libs += [
-        "FontSub.lib",
-        "User32.lib",
-        "Usp10.lib",
+        "fontsub",
+        "user32",
+        "usp10",
       ]
     }
   } else {
@@ -1935,7 +1936,7 @@
 }
 
 config("cpp17") {
-  if (is_win) {
+  if (is_msvc) {
     cflags_cc = [ "/std:c++17" ]
   } else {
     cflags_cc = [ "-std=c++17" ]
@@ -1976,7 +1977,7 @@
       "tools/fiddle/examples.cpp",
       "tools/fiddle/examples.h",
     ]
-    if (is_win) {
+    if (is_msvc) {
       cflags = [
         "/wd4756",  # Overflow in constant arithmetic
         "/wd4305",  # truncation from 'double' to 'float'
@@ -2200,9 +2201,9 @@
           "tools/gpu/gl/win/SkWGL.h",
           "tools/gpu/gl/win/SkWGL_win.cpp",
         ]
-        libs += [ "Gdi32.lib" ]
+        libs += [ "gdi32" ]
         if (target_cpu != "arm64") {
-          libs += [ "OpenGL32.lib" ]
+          libs += [ "opengl32" ]
         }
       }
     }
diff --git a/gn/BUILDCONFIG.gn b/gn/BUILDCONFIG.gn
index 146ad60b4b..a41321f766 100644
--- a/gn/BUILDCONFIG.gn
+++ b/gn/BUILDCONFIG.gn
@@ -71,6 +71,8 @@ is_linux = current_os == "linux"
 is_mac = current_os == "mac"
 is_wasm = current_os == "wasm"
 is_win = current_os == "win"
+is_mingw = is_win && (cxx == "g++" || cxx == "clang++")
+is_msvc = is_win && !is_mingw
 
 # This is just to make the Dawn build files happy. Skia itself uses target_os = "linux"
 # for ChromeOS, so this variable will not affect Skia proper.
@@ -126,7 +128,7 @@ if (is_android) {
   }
 }
 
-if (target_os == "win") {
+if (is_msvc) {
   # By default we look for 2017 (Enterprise, Pro, and Community), then 2015. If MSVC is installed in a
   # non-default location, you can set win_vc to inform us where it is.
 
@@ -137,7 +139,7 @@ if (target_os == "win") {
                         # directory.
 }
 
-if (target_os == "win") {
+if (is_msvc) {
   if (win_toolchain_version == "") {
     win_toolchain_version = exec_script("//gn/highest_version_dir.py",
                                         [
@@ -230,7 +232,7 @@ if (!is_official_build) {
       [ "//gn/skia:warnings_for_public_headers" ]
 }
 
-if (is_win) {
+if (is_msvc) {
   # Windows tool chain
   set_default_toolchain("//gn/toolchain:msvc")
   default_toolchain_name = "msvc"
--- skia/gn/skia/BUILD.gn.orig	2025-08-05 17:55:17.000000000 +0200
+++ skia/gn/skia/BUILD.gn	2026-01-17 15:02:30.460683900 +0100
@@ -64,12 +64,12 @@
   # Disable warnings about unknown attributes.
   # (These unknown attribute warnings are on by default, so we don't make
   # disabling them part of :warnings, as some targets remove :warnings.)
-  if (is_win && !is_clang) {
+  if (is_msvc && !is_clang) {
     cflags += [
       "/wd5030",
       "/wd5051",
     ]
-  } else {
+  } else if (!is_mingw) {
     cflags += [ "-Wno-attributes" ]
   }
 
@@ -99,7 +99,7 @@
     asmflags += [ target_triple ]
   }
 
-  if (is_win) {
+  if (is_msvc) {
     if (is_clang && current_cpu == "arm64") {
       cflags += [ "--target=arm64-windows" ]
     }
@@ -149,10 +149,29 @@
       "$win_vc/Tools/MSVC/$win_toolchain_version/lib/$current_cpu",
     ]
   } else {
-    cflags += [
-      "-fPIC",
-      "-fvisibility=hidden",
-    ]
+    if (is_mingw) {
+      if (target_cpu == "arm64") {
+        cflags += [
+          "-march=armv8-a+simd+fp",
+        ]
+      } else {
+        cflags += [
+          "-mavx2",
+          "-mavx512f",
+          "-mf16c",
+          "-mfma",
+        ]
+      }
+      cflags += [
+        "-fpermissive",
+        "-fvisibility=default",
+      ]
+    } else {
+      cflags += [
+        "-fPIC",
+        "-fvisibility=hidden",
+      ]
+    }
     cflags_cc += [ "-fvisibility-inlines-hidden" ]
     if (skia_use_cpp20) {
       cflags_cc += [ "-std=c++20" ]
@@ -192,6 +211,20 @@
     libs += [ malloc ]
   }
 
+  if (is_mingw) {
+    defines += [
+      "_CRT_SECURE_NO_WARNINGS",
+      "WIN32_LEAN_AND_MEAN",
+      "NOMINMAX",
+    ]
+    if (!is_clang) {
+      cflags += [
+        "-Wno-attributes",
+        "-Wno-stringop-overflow",
+      ]
+    }
+  }
+
   if (is_android) {
     cflags += [ "--sysroot=$ndk/toolchains/llvm/prebuilt/$ndk_host/sysroot" ]
     ldflags += [ "-static-libstdc++" ]
@@ -199,7 +232,7 @@
 
   if (show_includes) {
     assert(is_clang, "show_includes requires clang to build.")
-    if (is_win) {
+    if (is_msvc) {
       cflags += [
         "/clang:-H",
         "/clang:-fshow-skipped-includes",
@@ -379,7 +412,7 @@
       cflags += [ "-fno-sanitize=function" ]
     }
 
-    if (is_win) {
+    if (is_msvc) {
       cflags += [
         # On Release builds, we get strange warnings about string literals.
         "/GF-",
@@ -418,7 +451,7 @@
 
 config("no_exceptions") {
   # Exceptions are disabled by default on Windows.  (Use /EHsc to enable them.)
-  if (!is_win) {
+  if (!is_msvc) {
     cflags_cc = [ "-fno-exceptions" ]
     cflags_objcc = cflags_cc
   }
@@ -431,14 +464,14 @@
   cflags_objcc = []
 
   if (werror) {
-    if (is_win) {
+    if (is_msvc) {
       cflags += [ "/WX" ]
     } else {
       cflags += [ "-Werror" ]
     }
   }
 
-  if (is_win) {
+  if (is_msvc) {
     cflags += [
       "/W3",  # Turn on lots of warnings.
 
@@ -640,7 +673,7 @@
   }
 
   # !is_clang is a proxy for gcc.
-  if (!is_clang && !is_win) {
+  if (!is_clang && !is_msvc) {
     cflags += [
       "-Wno-unreachable-code",  # Causes false positives in old GCC; removed
                                 # from modern GCC entirely
@@ -684,7 +717,7 @@
       "-gline-tables-only",
       "-funwind-tables",  # Helps make in-process backtraces fuller.
     ]
-  } else if (is_win) {
+  } else if (is_msvc) {
     cflags = [ "/Z7" ]
     if (is_clang) {
       cflags += [ "-gcodeview-ghash" ]
@@ -702,7 +735,7 @@
 
 config("no_rtti") {
   if (sanitize != "ASAN") {  # -fsanitize=vptr requires RTTI
-    if (is_win) {
+    if (is_msvc) {
       cflags_cc = [ "/GR-" ]
     } else {
       cflags_cc = [ "-fno-rtti" ]
@@ -713,7 +746,7 @@
 
 config("optimize") {
   ldflags = []
-  if (is_win) {
+  if (is_msvc) {
     cflags = [
       "/O2",
       "/Zc:inline",
@@ -728,7 +761,7 @@
   } else {
     if (skia_enable_optimize_size) {
       cflags = [ "-Oz" ]
-      if (!is_android) {
+      if (!is_android && !is_mingw) {
         cflags += [
           # Clang 15 turns PIE (Position-indendendent Executable) on by default.
           "-fno-PIE",
@@ -768,12 +801,12 @@
 #
 # As of 2024, only GCC is aggressive about strict aliasing. Clang isn't.
 config("strict_aliasing") {
-  if (!is_win) {
+  if (!is_win || is_mingw) {
     cflags = [ "-fstrict-aliasing" ]
   }
 }
 config("no_strict_aliasing") {
-  if (!is_win) {
+  if (!is_win || is_mingw) {
     cflags = [ "-fno-strict-aliasing" ]
   }
 }
@@ -791,7 +824,9 @@
       "-rdynamic",
       "-Wl,-rpath,\$ORIGIN",
     ]
-  } else if (is_win) {
+  } else if (is_mingw) {
+    ldflags = [ "-mconsole" ]
+  } else if (is_msvc) {
     ldflags = [
       "/SUBSYSTEM:CONSOLE",  # Quiet "no subsystem specified; CONSOLE assumed".
       "/INCREMENTAL:NO",  # Quiet warnings about failing to incrementally link
diff --git a/gn/toolchain/BUILD.gn b/gn/toolchain/BUILD.gn
index 4d4abc952f..1c4c7ae412 100644
--- a/gn/toolchain/BUILD.gn
+++ b/gn/toolchain/BUILD.gn
@@ -56,7 +56,7 @@ declare_args() {
 }
 
 # For 'shell' see https://ninja-build.org/manual.html#ref_rule_command
-if (host_os == "win") {
+if (is_msvc) {
   shell = "cmd.exe /c "
   stamp = "$shell echo >"
 } else {
@@ -322,8 +322,7 @@ template("gcc_like_toolchain") {
       } else {
         rspfile = "{{output}}.rsp"
         rspfile_content = "{{inputs}}"
-        rm_py = rebase_path("../rm.py")
-        command = "$shell python3 \"$rm_py\" \"{{output}}\" && $ar rcs {{output}} @$rspfile"
+        command = "$ar rcs {{output}} @$rspfile"
       }
 
       outputs =
@@ -342,6 +341,8 @@ template("gcc_like_toolchain") {
       rpath = "-Wl,-soname,$soname"
       if (is_mac || is_ios) {
         rpath = "-Wl,-install_name,@rpath/$soname"
+      } else if (is_mingw) {
+        rpath = ""  # For PE/COFF the soname argument has no effect
       }
 
       rspfile = "{{output}}.rsp"
@@ -360,11 +361,18 @@ template("gcc_like_toolchain") {
         _end_group = ""
       }
 
-      command = "$link -shared {{ldflags}} $_start_group @$rspfile {{frameworks}} {{solibs}} $_end_group {{libs}} $rpath -o {{output}}"
+      soname_flags = ""
+      if (is_mingw) {
+        soname_flags = "-Wl,--out-implib=$soname.a"
+      }
+
+      command = "$link -shared $soname_flags {{ldflags}} $_start_group @$rspfile {{frameworks}} {{solibs}} {{libs}} $_end_group $rpath -o {{output}}"
       outputs = [ "{{root_out_dir}}/$soname" ]
       output_prefix = "lib"
       if (is_mac || is_ios) {
         default_output_extension = ".dylib"
+      } else if (is_mingw) {
+        default_output_extension = ".dll"
       } else {
         default_output_extension = ".so"
       }
diff --git a/modules/skcms/BUILD.gn b/modules/skcms/BUILD.gn
index 5d037a94c9..4385748ac3 100644
--- a/modules/skcms/BUILD.gn
+++ b/modules/skcms/BUILD.gn
@@ -33,7 +33,7 @@ template("arch") {
 arch("skcms_TransformHsw") {
   enabled = current_cpu == "x64" && target_os != "android"
   sources = skcms_TransformHsw
-  if (is_win) {
+  if (is_msvc) {
     if (is_clang) {
       cflags = [
         "/clang:-mavx2",
@@ -43,6 +43,8 @@ arch("skcms_TransformHsw") {
     } else {
       cflags = [ "/arch:AVX2" ]
     }
+  } else if (is_mingw) {
+    cflags = [ "-march=haswell" ]
   } else {
     cflags = [
       "-mavx2",
@@ -55,7 +57,7 @@ arch("skcms_TransformHsw") {
 arch("skcms_TransformSkx") {
   enabled = current_cpu == "x64" && target_os != "android"
   sources = skcms_TransformSkx
-  if (is_win) {
+  if (is_msvc) {
     if (is_clang) {
       cflags = [
         "/clang:-mavx512f",
@@ -68,6 +70,8 @@ arch("skcms_TransformSkx") {
     } else {
       cflags = [ "/arch:AVX512" ]
     }
+  } else if (is_mingw) {
+    cflags = [ "-march=skylake-avx512" ]
   } else {
     cflags = [
       "-mavx512f",
@@ -83,7 +87,7 @@ arch("skcms_TransformSkx") {
 static_library("skcms") {
   cflags = []
   if (!is_win || is_clang) {
-    cflags += [ "-std=c11" ]
+    cflags_c = [ "-std=c11" ]
   }
   if (target_cpu != "x64" || target_os == "android") {
     defines = [
diff --git a/third_party/third_party.gni b/third_party/third_party.gni
index cbcd16cf38..207380f7e1 100644
--- a/third_party/third_party.gni
+++ b/third_party/third_party.gni
@@ -13,7 +13,7 @@ template("third_party_config") {
     if (enabled) {
       forward_variables_from(invoker, "*", [ "include_dirs" ])
       cflags = []
-      if (is_win) {
+      if (is_msvc) {
         include_dirs = invoker.include_dirs
         if (is_clang) {
           foreach(dir, invoker.include_dirs) {
@@ -92,7 +92,7 @@ template("third_party") {
       if (!defined(cflags)) {
         cflags = []
       }
-      if (is_win) {
+      if (is_msvc) {
         cflags += [ "/w" ]
       } else {
         cflags += [ "-w" ]

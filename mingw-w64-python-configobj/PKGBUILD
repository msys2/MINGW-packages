# Maintainer:
# Contributor:

_realname=configobj
pkgbase=mingw-w64-python-${_realname}
pkgname=("${MINGW_PACKAGE_PREFIX}-python-${_realname}")
pkgver=5.0.8
pkgrel=1
pkgdesc='Simple config file reader and writer (mingw-w64)'
arch=('any')
url='https://github.com/DiffSK/configobj'
license=(BSD)
msys2_references=(
  'pypi: configobj'
)
depends=("${MINGW_PACKAGE_PREFIX}-python-six")
makedepends=(
  git
  "${MINGW_PACKAGE_PREFIX}-python-build"
  "${MINGW_PACKAGE_PREFIX}-python-installer"
  "${MINGW_PACKAGE_PREFIX}-python-setuptools"
  "${MINGW_PACKAGE_PREFIX}-python-wheel"
)
options=('!strip')
source=("https://pypi.org/packages/source/${_realname::1}/${_realname}/${_realname}-${pkgver}.tar.gz")
sha256sums=('6f704434a07dc4f4dc7c9a745172c1cad449feb548febd9f7fe362629c627a97')
b2sums=('30b03801e3180a7706bf98cd8a4c330fef97f960237cad9a5756053295ffba15cce9ce917dc8c688448a84b94e4ec2b3fcce1238ad2a44c3be4df1c7513d4fbf')

prepare() {
  cd "${srcdir}/${_realname}-${pkgver}"
}

build() {
  cp -r "${_realname}-${pkgver}" "python-build-${MSYSTEM}" && cd "python-build-${MSYSTEM}"
  ${MINGW_PREFIX}/bin/python -m build --wheel --skip-dependency-check --no-isolation
}

package() {
  cd "${srcdir}/python-build-${MSYSTEM}"
  MSYS2_ARG_CONV_EXCL="--prefix=" \
    ${MINGW_PREFIX}/bin/python -m installer --prefix=${MINGW_PREFIX} \
    --destdir="${pkgdir}" dist/*.whl
  #${MINGW_PREFIX}/bin/python setup.py install --root="$pkgdir" --optimize=1
  install -Dm644 LICENSE "$pkgdir/usr/share/licenses/$pkgname/LICENSE"
  #${MINGW_PREFIX}/bin/python setup_validate.py install --root="$pkgdir" --optimize=1
}

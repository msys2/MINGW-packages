From 23da341caee0cdc06842eb9ee5c9dd5c9b37e834 Mon Sep 17 00:00:00 2001
From: Joel Holdsworth <jholdsworth@nvidia.com>
Date: Mon, 23 Feb 2026 14:44:30 -0800
Subject: [PATCH] Use git version that matches python arch

---
 src/west/app/project.py | 7 +++++--
 src/west/commands.py    | 2 +-
 src/west/manifest.py    | 5 +++--
 3 files changed, 9 insertions(+), 5 deletions(-)

diff --git a/src/west/app/project.py b/src/west/app/project.py
index 7f04574..ef5bc16 100644
--- a/src/west/app/project.py
+++ b/src/west/app/project.py
@@ -119,7 +119,8 @@ class _ProjectCommand(WestCommand):
         # manually use Popen in order to try to exit as quickly as
         # possible if 'git status' prints anything.
 
-        popen = subprocess.Popen(['git', 'status', '--porcelain'],
+        popen = subprocess.Popen([str(Path(sys.executable).parent / 'git'),
+                                  'status', '--porcelain'],
                                  stdout=subprocess.PIPE,
                                  stderr=subprocess.PIPE,
                                  cwd=project.abspath)
@@ -340,7 +341,9 @@ below.
                 f'Cloning manifest repository from {manifest_url}' +
                 (f', rev. {args.manifest_rev}' if args.manifest_rev else ''))
 
-            self.check_call(['git', 'clone'] + branch_opt + args.clone_opt +
+            self.check_call([str(Path(sys.executable).parent / 'git'),
+                             'clone'] +
+                            branch_opt + args.clone_opt +
                             [manifest_url, os.fspath(tempdir)])
         except subprocess.CalledProcessError:
             shutil.rmtree(tempdir, ignore_errors=True)
diff --git a/src/west/commands.py b/src/west/commands.py
index 45da2fc..a50e006 100644
--- a/src/west/commands.py
+++ b/src/west/commands.py
@@ -333,7 +333,7 @@ class WestCommand(ABC):
         '''Abort if git is not installed on PATH.
         '''
         if not hasattr(self, '_git'):
-            self._git = shutil.which('git')
+            self._git = str(Path(sys.executable).parent / 'git')
         if self._git is None:
             self.die("can't find git; install it or ensure it's on your PATH")
 
diff --git a/src/west/manifest.py b/src/west/manifest.py
index d871298..4142227 100644
--- a/src/west/manifest.py
+++ b/src/west/manifest.py
@@ -956,7 +956,7 @@ class Project:
             # Windows, do the right thing.
             cwd = os.fspath(cwd)
 
-        args = ['git'] + cmd_list + extra_args
+        args = [Path(sys.executable).parent / 'git'] + cmd_list + extra_args
         cmd_str = util.quote_sh_list(args)
 
         _logger.debug(f"running '{cmd_str}' in {cwd}")
@@ -1294,7 +1294,8 @@ class Manifest:
             # manifest.path, chopping off the newline, performing a
             # hopefully-safe decode, and resolving symlinks.
             manifest_abspath = Path(subprocess.check_output(
-                ['git', 'rev-parse', '--show-toplevel'],
+                [str(Path(sys.executable).parent / 'git'), 'rev-parse',
+                 '--show-toplevel'],
                 cwd=start)[:-1].decode('utf-8')).resolve()
             manifest_path = manifest_abspath.relative_to(topdir)
             patch_dict = {
-- 
2.53.0.windows.1


diff -bur ruby-3.1.3-orig/win32/win32.c ruby-3.1.3/win32/win32.c
--- ruby-3.1.3-orig/win32/win32.c	2023-11-22 13:02:46.411803200 -0700
+++ ruby-3.1.3/win32/win32.c	2023-11-22 13:02:56.312445900 -0700
@@ -2568,7 +2568,6 @@
 set_pioinfo_extra(void)
 {
 #if RUBY_MSVCRT_VERSION >= 140
-# define FUNCTION_RET 0xc3 /* ret */
 # ifdef _DEBUG
 #  define UCRTBASE "ucrtbased.dll"
 # else
@@ -2579,9 +2578,29 @@
     char *pend = p;
     /* _osfile(fh) & FDEV */
 
-# ifdef _WIN64
+# if defined(_M_ARM64)
+    char *page_base;
+    int32_t op;
+    char immlo;
+    int32_t immhi;
+    int32_t rel;
+    unsigned char sh;
+#  define FUNCTION_RET 0xc0 /* ret */
+    /* autibsp */
+#  define FUNCTION_BEFORE_RET_MARK "\xFF\x23\x03\xD5"
+#  define FUNCTION_SKIP_BYTES 0
+#  ifdef _DEBUG
+    /* adrp x8, _ */
+#   define PIOINFO_MARK "\x48\x13\x00\xF0"
+#  else
+    /* adrp x8,_ */
+#   define PIOINFO_MARK "\x28\x0E\x00\xB0"
+#  endif
+
+# elif defined(_WIN64)
     int32_t rel;
     char *rip;
+#  define FUNCTION_RET 0xc3 /* ret */
     /* add rsp, _ */
 #  define FUNCTION_BEFORE_RET_MARK "\x48\x83\xc4"
 #  define FUNCTION_SKIP_BYTES 1
@@ -2594,6 +2613,7 @@
 #  endif
 
 # else /* x86 */
+#  define FUNCTION_RET 0xc3 /* ret */
     /* pop ebp */
 #  define FUNCTION_BEFORE_RET_MARK "\x5d"
     /* leave */
@@ -2627,7 +2647,23 @@
 
     found:
     p += sizeof(PIOINFO_MARK) - 1;
-#ifdef _WIN64
+
+#if defined(_M_ARM64)
+    // ADRP
+    page_base = (char*)((int64_t)(p) & 0xFFFFFFFFFFFFF000);
+    op = *(int32_t*)(p);
+    immlo = (op & 0x60000000) >> 29;
+    immhi = (op & 0x00FFFFE0) >> 5;
+    rel = ((immhi << 2) | immlo) << 12;
+    // ADD
+    p += sizeof(PIOINFO_MARK) - 1;
+    op = *(int32_t*)(p);
+    sh = (op & 0x00400000) >> 22;
+    immhi = (op & 0x003FFC00) >> 10;
+    immhi = immhi << (sh == 1 ? 12 : 0);
+    rel += immhi;
+    __pioinfo = (ioinfo**)(page_base + rel);
+#elif defined(_WIN64)
     rel = *(int32_t*)(p);
     rip = p + sizeof(int32_t);
     __pioinfo = (ioinfo**)(rip + rel);

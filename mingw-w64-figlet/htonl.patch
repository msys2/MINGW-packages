diff --git a/utf8.c b/utf8.c
index b8338c1..013fdd6 100644
--- a/utf8.c
+++ b/utf8.c
@@ -17,7 +17,22 @@
 #include <sys/types.h>
 
 #include <wchar.h>
-#include <arpa/inet.h>	/* for htonl() */
+
+#if __BYTE_ORDER__ == __ORDER_BIG_ENDIAN__
+# define htonl(h) (h)
+#elif __BYTE_ORDER__ == __ORDER_LITTLE_ENDIAN__
+# define htonl(x) ((unsigned long int) ( \
+    (((unsigned long int)(x) & 0x000000ffU) << 24) | \
+    (((unsigned long int)(x) & 0x0000ff00U) <<  8) | \
+    (((unsigned long int)(x) & 0x00ff0000U) >>  8) | \
+    (((unsigned long int)(x) & 0xff000000U) >> 24)))
+#else
+# include <arpa/inet.h> /* for htonl() */
+#endif
+
+#ifdef _WIN32
+typedef unsigned char u_char;
+#endif
 
 #include "utf8.h"
 

From 1c9436c0f17cc5d479e033ae16501e69373567b8 Mon Sep 17 00:00:00 2001
From: GH Cao <driver1998.ms@outlook.com>
Date: Sun, 31 Aug 2025 00:50:18 +0800
Subject: [PATCH] Fix building on MSYS2 with QT6

---
 src/qt/qt_mediahistorymanager.cpp | 2 +-
 src/qt/qt_mediamenu.cpp           | 3 +--
 src/qt/qt_rendererstack.cpp       | 4 ++++
 3 files changed, 6 insertions(+), 3 deletions(-)

diff --git a/src/qt/qt_mediahistorymanager.cpp b/src/qt/qt_mediahistorymanager.cpp
index 47ff7b4b5b0..ff9f1cf1c95 100644
--- a/src/qt/qt_mediahistorymanager.cpp
+++ b/src/qt/qt_mediahistorymanager.cpp
@@ -381,7 +381,7 @@ MediaHistoryManager::removeMissingImages(device_index_list_t &device_history)
 
 #ifdef Q_OS_WINDOWS
         if (new_fi.filePath().left(8) == "ioctl://")
-            file_exists = (GetDriveType(new_fi.filePath().right(2).toUtf8().data()) == DRIVE_CDROM);
+            file_exists = (GetDriveTypeA(new_fi.filePath().right(2).toUtf8().data()) == DRIVE_CDROM);
 #endif
 
         if (!file_exists) {
diff --git a/src/qt/qt_mediamenu.cpp b/src/qt/qt_mediamenu.cpp
index 465c561294b..b42812ad669 100644
--- a/src/qt/qt_mediamenu.cpp
+++ b/src/qt/qt_mediamenu.cpp
@@ -31,7 +31,6 @@
 extern "C" {
 #ifdef Q_OS_WINDOWS
 #define BITMAP WINDOWS_BITMAP
-#undef UNICODE
 #include <windows.h>
 #include <windowsx.h>
 #undef BITMAP
@@ -176,7 +175,7 @@ MediaMenu::refresh(QMenu *parentMenu)
            it's a CDROM */
         for (const auto &letter : driveLetters) {
             auto drive = QString("%1:\\").arg(letter);
-            if (GetDriveType(drive.toUtf8().constData()) == DRIVE_CDROM)
+            if (GetDriveTypeA(drive.toUtf8().constData()) == DRIVE_CDROM)
                 menu->addAction(QIcon(":/settings/qt/icons/cdrom_host.ico"), tr("&Host CD/DVD Drive (%1:)").arg(letter), [this, i, letter] { cdromMount(i, 2, QString(R"(\\.\%1:)").arg(letter)); })->setCheckable(false);
         }
         menu->addSeparator();
diff --git a/src/qt/qt_rendererstack.cpp b/src/qt/qt_rendererstack.cpp
index ade27d831b1..32b017b92d6 100644
--- a/src/qt/qt_rendererstack.cpp
+++ b/src/qt/qt_rendererstack.cpp
@@ -62,6 +62,10 @@
 #    include <CoreGraphics/CoreGraphics.h>
 #endif
 
+#ifdef Q_OS_WINDOWS
+#    include <windows.h>
+#endif
+
 extern "C" {
 #include <86box/86box.h>
 #include <86box/config.h>

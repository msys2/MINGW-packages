From b998f6a300697018b5bd4a84bfd3b54a47c4e26b Mon Sep 17 00:00:00 2001
From: Tim Stahlhut <stahta01@gmail.com>
Date: Wed, 15 Oct 2025 07:48:05 -0400
Subject: Add BUILD_FOR_MSYS2_MINGW_PACKAGE cmake guards

---
 CMakeLists.txt                  | 14 +++++++-------
 CodeFormatter/CMakeLists.txt    |  2 +-
 DatabaseExplorer/CMakeLists.txt |  4 ++--
 LanguageServer/CMakeLists.txt   |  2 +-
 codelitephp/CMakeLists.txt      |  2 +-
 5 files changed, 12 insertions(+), 12 deletions(-)

diff --git a/CMakeLists.txt b/CMakeLists.txt
index ebcdfd2c7..1b92ac0cf 100644
--- a/CMakeLists.txt
+++ b/CMakeLists.txt
@@ -73,7 +73,7 @@ if(UNIX AND NOT APPLE)
     endif()
 endif()
 
-if(MINGW)
+if(MINGW AND NOT BUILD_FOR_MSYS2_MINGW_PACKAGE)
     set(CMAKE_INSTALL_PREFIX "${CMAKE_BINARY_DIR}/install")
     set(CL_PREFIX "${CMAKE_INSTALL_PREFIX}")
     if(NOT DEFINED ENV{MSYS2_BASE})
@@ -83,7 +83,7 @@ if(MINGW)
         )
     endif()
     set(MSYS2_BASE $ENV{MSYS2_BASE})
-elseif(UNIX AND NOT APPLE)
+elseif(BUILD_FOR_MSYS2_MINGW_PACKAGE OR UNIX AND NOT APPLE)
     if(CL_PREFIX)
         # user provided CL_PREFIX -> use it instead of CMAKE_INSTALL_PREFIX
         set(CMAKE_INSTALL_PREFIX "${CL_PREFIX}")
@@ -312,7 +312,7 @@ if(APPLE)
     set(PLUGINS_DIR ${CMAKE_BINARY_DIR}/codelite.app/Contents/SharedSupport/plugins)
     set(CL_INSTALL_BIN ${CMAKE_BINARY_DIR}/codelite.app/Contents/MacOS)
     set(CL_RESOURCES_DIR ${CMAKE_BINARY_DIR}/codelite.app/Contents/SharedSupport)
-elseif(MINGW)
+elseif(MINGW AND NOT BUILD_FOR_MSYS2_MINGW_PACKAGE)
     set(PLUGINS_DIR "${MINGW_INSTALL_PLUGINS_DIR}")
     set(CL_INSTALL_BIN "${MINGW_INSTALL_BIN}")
     set(CL_RESOURCES_DIR "${MINGW_INSTALL_BIN}")
@@ -435,7 +435,7 @@ if(UNIX AND NOT APPLE)
 endif(UNIX AND NOT APPLE)
 
 # find wxWidgets once
-if(MINGW)
+if(MINGW AND NOT BUILD_FOR_MSYS2_MINGW_PACKAGE)
     if(NOT WXWIN)
         message(FATAL_ERROR "Missing -DWXWIN=<wxWidgets/root/install/dir>")
     endif()
@@ -1083,7 +1083,7 @@ if(NOT WXC_APP)
 
 endif()
 
-if(MINGW)
+if(MINGW AND NOT BUILD_FOR_MSYS2_MINGW_PACKAGE)
     # determine MSYS2 path
     write_file(${CMAKE_BINARY_DIR}/msys2-environment "export WXWIN=${WXWIN}")
     write_file(${CMAKE_BINARY_DIR}/msys2-environment "export MSYS2_HOME=${MSYS2_BASE}" APPEND)
@@ -1149,7 +1149,7 @@ if(MINGW)
 
 endif()
 
-if(MINGW AND NOT WXC_APP)
+if(MINGW AND NOT WXC_APP AND NOT BUILD_FOR_MSYS2_MINGW_PACKAGE)
     # configure the innosetup file
     configure_file(${CL_SRC_ROOT}/InnoSetup/codelite64_mingw.iss.in ${BUILD_DIRECTORY}/codelite64_mingw.iss)
 
@@ -1173,7 +1173,7 @@ if(MINGW AND NOT WXC_APP)
             WORKING_DIRECTORY "${CL_SRC_ROOT}/InnoSetup"
             DEPENDS codelite-install)
     endif()
-elseif(MINGW AND WXC_APP)
+elseif(MINGW AND WXC_APP AND NOT BUILD_FOR_MSYS2_MINGW_PACKAGE)
     # configure the innosetup file
     configure_file(${CL_SRC_ROOT}/wxcrafter/wxcrafter64_mingw.iss.in ${BUILD_DIRECTORY}/wxcrafter64_mingw.iss)
 
diff --git a/CodeFormatter/CMakeLists.txt b/CodeFormatter/CMakeLists.txt
index 35443f1f5..c53ab280a 100644
--- a/CodeFormatter/CMakeLists.txt
+++ b/CodeFormatter/CMakeLists.txt
@@ -33,7 +33,7 @@ target_link_libraries(${PLUGIN_NAME} ${LINKER_OPTIONS} libcodelite plugin)
 
 cl_install_plugin(${PLUGIN_NAME})
 
-if(MINGW)
+if(MINGW AND NOT BUILD_FOR_MSYS2_MINGW_PACKAGE)
     # install clang-format
     msys_install_clang64_tool(clang-format.exe ${CL_INSTALL_BIN})
 endif()
diff --git a/DatabaseExplorer/CMakeLists.txt b/DatabaseExplorer/CMakeLists.txt
index 5097ec339..ef624665b 100644
--- a/DatabaseExplorer/CMakeLists.txt
+++ b/DatabaseExplorer/CMakeLists.txt
@@ -18,7 +18,7 @@ if(WITH_MYSQL)
     endif(${LIBMYSQLCLIENT} STREQUAL "LIBMYSQLCLIENT-NOTFOUND")
     add_definitions(-DDBL_USE_MYSQL=1)
 
-    if(MINGW)
+    if(MINGW AND NOT BUILD_FOR_MSYS2_MINGW_PACKAGE)
         install(FILES "${MSYS2_BASE}/clang64/bin/libmariadb.dll" DESTINATION "${CMAKE_INSTALL_PREFIX}")
         msys_list_deps(${MSYS2_BASE}/clang64/bin/libmariadb.dll LIBMARIA_DEPS)
         foreach(DEP ${LIBMARIA_DEPS})
@@ -33,7 +33,7 @@ if(WITH_POSTGRES)
 
     add_compile_definitions(DBL_USE_POSTGRES=1)
 
-    if(MINGW)
+    if(MINGW AND NOT BUILD_FOR_MSYS2_MINGW_PACKAGE)
         install(FILES "${MSYS2_BASE}/clang64/bin/libpq.dll" DESTINATION "${CMAKE_INSTALL_PREFIX}")
         msys_list_deps(${MSYS2_BASE}/clang64/bin/libpq.dll LIBPOSTGRES_DEPS)
         foreach(DEP ${LIBPOSTGRES_DEPS})
diff --git a/LanguageServer/CMakeLists.txt b/LanguageServer/CMakeLists.txt
index 0b6c27802..60fdd7352 100644
--- a/LanguageServer/CMakeLists.txt
+++ b/LanguageServer/CMakeLists.txt
@@ -52,7 +52,7 @@ if(APPLE)
         PERMISSIONS ${EXE_PERM})
 endif()
 
-if(MINGW)
+if(MINGW AND NOT BUILD_FOR_MSYS2_MINGW_PACKAGE)
     # install clangd
     msys_install_clang64_tool(clangd.exe ${CL_INSTALL_BIN})
 endif()
diff --git a/codelitephp/CMakeLists.txt b/codelitephp/CMakeLists.txt
index 4955cca72..1380a6f35 100644
--- a/codelitephp/CMakeLists.txt
+++ b/codelitephp/CMakeLists.txt
@@ -2,7 +2,7 @@ project("codelitephp")
 # set the plugin name here
 set(PLUGIN_NAME "codelitephp")
 
-if(NOT MINGW)
+if(BUILD_FOR_MSYS2_MINGW_PACKAGE OR NOT MINGW)
     add_definitions(-DPLUGINS_DIR=\"${PLUGINS_DIR}\")
 endif()
 
-- 

From 0b20d21686923ec99b3dbde4871893407157ec69 Mon Sep 17 00:00:00 2001
From: Tim Stahlhut <stahta01@gmail.com>
Date: Tue, 26 Jul 2022 22:07:09 -0400
Subject: wxCrafter standalone build fixes for MSys2

---
 wxcrafter/CMakeLists.txt | 27 ++++++++++++++++++---------
 1 file changed, 18 insertions(+), 9 deletions(-)

diff --git a/wxcrafter/CMakeLists.txt b/wxcrafter/CMakeLists.txt
index 62dc609f5..786cb6e40 100644
--- a/wxcrafter/CMakeLists.txt
+++ b/wxcrafter/CMakeLists.txt
@@ -120,11 +120,18 @@ else(OFFICIAL_CL_BUILD)
 endif(NOT OFFICIAL_CL_BUILD)
 
 else()
+
+  if (UNIX)
+    set(ADDITIONAL_WXC_APP_LIBRARIES "-lutil")
+  else (UNIX)
+    set(ADDITIONAL_WXC_APP_LIBRARIES "-lws2_32")
+  endif (UNIX)
+
     target_link_libraries(${PLUGIN_NAME} ${LINKER_OPTIONS} ${wxWidgets_LIBRARIES}
                           wxsqlite3
                           libcodelite
                           plugin
-                          -lutil)
+                          ${ADDITIONAL_WXC_APP_LIBRARIES})
 endif()
 
 if ( NOT WXC_APP )
@@ -138,16 +145,16 @@ else ()
     install(FILES "${WXC_DIR}/wxgui.zip" DESTINATION ${CL_PREFIX}/share/${PLUGIN_NAME} COMPONENT standalone)
     install(FILES "${CL_SRC_ROOT}/Runtime/codelite-bitmaps-light.zip" DESTINATION ${CL_PREFIX}/share/${PLUGIN_NAME} COMPONENT standalone)
     install(FILES "${CL_SRC_ROOT}/Runtime/codelite-bitmaps-dark.zip" DESTINATION ${CL_PREFIX}/share/${PLUGIN_NAME} COMPONENT standalone)
-    install(FILES "${CMAKE_LIBRARY_OUTPUT_DIRECTORY}/liblibcodelite.so" DESTINATION ${WXC_LIBS_DIR} COMPONENT standalone)
-    install(FILES "${CMAKE_LIBRARY_OUTPUT_DIRECTORY}/libplugin.so" DESTINATION ${WXC_LIBS_DIR} COMPONENT standalone)
-    install(FILES "${CMAKE_LIBRARY_OUTPUT_DIRECTORY}/libwxsqlite3.so" DESTINATION ${WXC_LIBS_DIR} COMPONENT standalone)
+#    install(FILES "${CMAKE_LIBRARY_OUTPUT_DIRECTORY}/liblibcodelite.so" DESTINATION ${WXC_LIBS_DIR} COMPONENT standalone)
+#    install(FILES "${CMAKE_LIBRARY_OUTPUT_DIRECTORY}/libplugin.so" DESTINATION ${WXC_LIBS_DIR} COMPONENT standalone)
+#    install(FILES "${CMAKE_LIBRARY_OUTPUT_DIRECTORY}/libwxsqlite3.so" DESTINATION ${WXC_LIBS_DIR} COMPONENT standalone)
     install(FILES "${CL_SRC_ROOT}/wxcrafter/resources/wxc-logo-64.png" DESTINATION ${CL_PREFIX}/share/${PLUGIN_NAME} COMPONENT standalone)
-    install(FILES "${CL_SRC_ROOT}/Runtime/config/codelite.xml.default.gtk" DESTINATION ${CL_PREFIX}/share/${PLUGIN_NAME}/config RENAME codelite.xml.default  COMPONENT standalone)
+#    install(FILES "${CL_SRC_ROOT}/Runtime/config/codelite.xml.default.gtk" DESTINATION ${CL_PREFIX}/share/${PLUGIN_NAME}/config RENAME codelite.xml.default  COMPONENT standalone)
 
-    if ( NOT DEBUG_BUILD )
-        message("-- Will install ${CL_SRC_ROOT}/wxcrafter/wxCrafter.desktop to /usr/share/applications")
-        install(FILES "${CL_SRC_ROOT}/wxcrafter/wxCrafter.desktop" DESTINATION /usr/share/applications  COMPONENT standalone)
-    endif ( NOT DEBUG_BUILD )
+    #if ( NOT DEBUG_BUILD )
+        #message("-- Will install ${CL_SRC_ROOT}/wxcrafter/wxCrafter.desktop to /usr/share/applications")
+        #install(FILES "${CL_SRC_ROOT}/wxcrafter/wxCrafter.desktop" DESTINATION /usr/share/applications  COMPONENT standalone)
+    #endif ( NOT DEBUG_BUILD )
 
     ## Install codelite lexer files
     install(
@@ -159,6 +166,7 @@ else ()
         PATTERN ".git" EXCLUDE
     )
 
+  if (UNIX)
     ##############################################
     ## CPack
     ##############################################
@@ -202,4 +210,5 @@ else ()
     set(CPACK_DEBIAN_PACKAGE_RECOMMENDS   "build-essential")
     set(CPACK_DEBIAN_PACKAGE_DEPENDS      "libc6, libssh-4, libsqlite3-dev")
     INCLUDE(CPack)
+  endif(UNIX)
 endif(NOT WXC_APP)
-- 

From 2cfbfbc13aed852b510b39be894690b7076f6465 Mon Sep 17 00:00:00 2001
From: Tim Stahlhut <stahta01@gmail.com>
Date: Thu, 16 Oct 2025 07:17:54 -0400
Subject: Fix CI standard paths

---
 CMakeLists.txt                 | 14 ++++++++------
 CodeLite/cl_standard_paths.cpp |  6 +++---
 LiteEditor/app.cpp             |  2 +-
 3 files changed, 12 insertions(+), 10 deletions(-)

diff --git a/CMakeLists.txt b/CMakeLists.txt
index 00529b28a..f0329c54f 100644
--- a/CMakeLists.txt
+++ b/CMakeLists.txt
@@ -53,6 +53,8 @@ set(CMAKE_CXX_STANDARD 17)
 set(CMAKE_CXX_STANDARD_REQUIRED ON)
 set(CMAKE_CXX_EXTENSIONS OFF)
 
+set(BUILD_FOR_MSYS2_MINGW_PACKAGE ON)
+
 option(WITH_CHATAI "Enable ChatAI plugin" OFF)
 option(BUILD_TESTING "Build test executables" OFF)
 
@@ -539,14 +541,14 @@ osx_make_bundle_directory()
 
 add_definitions(-DYY_NEVER_INTERACTIVE=1)
 
-if(NOT MINGW)
+if(BUILD_FOR_MSYS2_MINGW_PACKAGE OR NOT MINGW)
+    add_definitions(-DPREFIX_DIR=\"${CL_PREFIX}\")
     add_definitions(-DINSTALL_DIR=\"${CL_PREFIX}/share/codelite\")
     add_definitions(-DPLUGINS_DIR=\"${PLUGINS_DIR}\")
-else()
-    if(WITH_POSIX_LAYOUT)
-        add_definitions(-DNDEBUG)
-        add_definitions(-DUSE_POSIX_LAYOUT)
-    endif()
+endif()
+
+if(MINGW AND WITH_POSIX_LAYOUT)
+    add_definitions(-DUSE_POSIX_LAYOUT)
 endif()
 
 message("-- PLUGINS_DIR is set to ${PLUGINS_DIR}")
diff --git a/CodeLite/cl_standard_paths.cpp b/CodeLite/cl_standard_paths.cpp
index 110eee725..c782daad3 100644
--- a/CodeLite/cl_standard_paths.cpp
+++ b/CodeLite/cl_standard_paths.cpp
@@ -150,7 +150,7 @@ wxString clStandardPaths::GetPluginsDirectory() const
     wxString pluginsDir = PLUGINS_DIR;
 #else
 #ifdef USE_POSIX_LAYOUT
-    wxFileName path(GetInstallDir() + wxT(PLUGINS_DIR), "");
+    wxFileName path(wxT(PLUGINS_DIR), "");
 #else
     wxFileName path(GetDataDir(), "");
     path.AppendDir("plugins");
@@ -167,7 +167,7 @@ wxString clStandardPaths::GetDataDir() const
     }
 
 #ifdef USE_POSIX_LAYOUT
-    wxFileName path(wxStandardPaths::Get().GetDataDir() + wxT(INSTALL_DIR), "");
+    wxFileName path(wxT(INSTALL_DIR), "");
     return path.GetPath();
 #else
     return wxStandardPaths::Get().GetDataDir();
@@ -267,7 +267,7 @@ wxString clStandardPaths::GetInstallDir() const
     return GetBinFolder();
 #else
 #ifdef USE_POSIX_LAYOUT
-    wxFileName path(wxStandardPaths::Get().GetDataDir(), "");
+    wxFileName path(wxT(PREFIX_DIR), "");
     return path.GetPath();
 #else
     return GetBinFolder();
diff --git a/LiteEditor/app.cpp b/LiteEditor/app.cpp
index 3f0eb452d..e40dd2d03 100644
--- a/LiteEditor/app.cpp
+++ b/LiteEditor/app.cpp
@@ -462,7 +462,7 @@ bool CodeLiteApp::OnInit()
         SetPluginLoadPolicy(PP_FromList);
     }
 
-#if defined(__WXMSW__)
+#if defined(__WXMSW__) && !defined(USE_POSIX_LAYOUT)
     wxString newBaseDir;
     if (m_parser.Found(wxT("b"), &newBaseDir)) {
         wxFileName bd(newBaseDir, wxEmptyString);
-- 

From 29998eaca3a4f4aa57d258a9f998368fb3f26d98 Mon Sep 17 00:00:00 2001
From: Tim Stahlhut <stahta01@gmail.com>
Date: Sun, 9 Nov 2025 11:30:32 -0500
Subject: Change Windows to always use the Posix layout

---
 CMakeLists.txt                       | 22 ++++++----------------
 CodeLite/cl_defs_msw.h               |  2 --
 CodeLite/cl_standard_paths.cpp       |  8 ++++----
 Debugger/CMakeLists.txt              |  2 +-
 LiteEditor/CMakeLists.txt            |  9 +--------
 LiteEditor/app.cpp                   | 12 ------------
 LiteEditor/frame.cpp                 |  2 +-
 Plugin/Debugger/debuggermanager.cpp  |  4 ----
 translations/CMakeLists.txt          |  6 +-----
 wxcrafter/src/wxgui_bitmaploader.cpp |  2 +-
 10 files changed, 15 insertions(+), 54 deletions(-)

diff --git a/CMakeLists.txt b/CMakeLists.txt
index 44e13d673..45c7f8502 100644
--- a/CMakeLists.txt
+++ b/CMakeLists.txt
@@ -35,8 +35,7 @@ cmake_minimum_required(VERSION 3.16)
 # Windows / MSYS options:
 #
 # -DWXWIN=<fullpath>                          //
-# https://docs.codelite.org/build/build_wx_widgets/#windows -DWITH_POSIX_LAYOUT
-# // When building under Windows, install CodeLite using POSIX layout
+# https://docs.codelite.org/build/build_wx_widgets/#windows
 #
 # ##############################################################################
 
@@ -333,15 +332,9 @@ endif()
 # Define the PLUGINS_DIR variable
 if(MINGW)
   # MinGW
-  if(WITH_POSIX_LAYOUT)
-    set(MINGW_INSTALL_PLUGINS_DIR "${CMAKE_INSTALL_PREFIX}/lib/codelite")
-    set(MINGW_INSTALL_BIN "${CMAKE_INSTALL_PREFIX}/bin")
-    set(MINGW_INSTALL_RESOURCES_DIR "${CMAKE_INSTALL_PREFIX}/share/codelite")
-  else()
-    set(MINGW_INSTALL_PLUGINS_DIR "${CMAKE_INSTALL_PREFIX}/plugins")
-    set(MINGW_INSTALL_BIN "${CMAKE_INSTALL_PREFIX}")
-    set(MINGW_INSTALL_RESOURCES_DIR "${MINGW_INSTALL_BIN}")
-  endif()
+  set(MINGW_INSTALL_PLUGINS_DIR "${CMAKE_INSTALL_PREFIX}/lib/codelite")
+  set(MINGW_INSTALL_BIN "${CMAKE_INSTALL_PREFIX}/bin")
+  set(MINGW_INSTALL_RESOURCES_DIR "${CMAKE_INSTALL_PREFIX}/share/codelite")
 endif()
 
 if(APPLE)
@@ -584,10 +577,7 @@ if(NOT MINGW)
   add_compile_definitions(INSTALL_DIR=\"${CL_PREFIX}/share/codelite\")
   add_compile_definitions(PLUGINS_DIR=\"${PLUGINS_DIR}\")
 else()
-  if(WITH_POSIX_LAYOUT)
-    add_compile_definitions(NDEBUG)
-    add_compile_definitions(USE_POSIX_LAYOUT)
-  endif()
+  add_compile_definitions(NDEBUG)
 endif()
 
 message("-- PLUGINS_DIR is set to ${PLUGINS_DIR}")
@@ -1223,7 +1213,7 @@ if(MINGW)
   endforeach()
 
   foreach(DLL ${OPENSSL_DEPS})
-    install(FILES "${DLL}" DESTINATION "${CMAKE_INSTALL_PREFIX}")
+    install(FILES "${DLL}" DESTINATION "${CL_INSTALL_BIN}")
   endforeach()
 
 endif()
diff --git a/CodeLite/cl_defs_msw.h b/CodeLite/cl_defs_msw.h
index d80f4097c..73b1b4367 100644
--- a/CodeLite/cl_defs_msw.h
+++ b/CodeLite/cl_defs_msw.h
@@ -9,14 +9,12 @@
 #define MAINBOOK_AUIBOOK 1
 #define USE_NATIVETOOLBAR 0
 
-#ifdef USE_POSIX_LAYOUT
 #ifndef PLUGINS_DIR
 #define PLUGINS_DIR "\\lib\\codelite"
 #endif
 #ifndef INSTALL_DIR
 #define INSTALL_DIR "\\share\\codelite"
 #endif
-#endif
 
 // General macros
 #define CL_USE_NEW_BUILD_TAB 1
diff --git a/CodeLite/cl_standard_paths.cpp b/CodeLite/cl_standard_paths.cpp
index d7d079c7a..5e7baca79 100644
--- a/CodeLite/cl_standard_paths.cpp
+++ b/CodeLite/cl_standard_paths.cpp
@@ -147,7 +147,7 @@ wxString clStandardPaths::GetPluginsDirectory() const
 #ifdef __WXGTK__
     wxString pluginsDir = PLUGINS_DIR;
 #else
-#ifdef USE_POSIX_LAYOUT
+#ifdef __WXMSW__
     wxFileName path(GetInstallDir() + wxT(PLUGINS_DIR), "");
 #else
     wxFileName path(GetDataDir(), "");
@@ -164,7 +164,7 @@ wxString clStandardPaths::GetDataDir() const
         return m_dataDir;
     }
 
-#ifdef USE_POSIX_LAYOUT
+#ifdef __WXMSW__
     wxFileName path(wxStandardPaths::Get().GetDataDir() + wxT(INSTALL_DIR), "");
     return path.GetPath();
 #else
@@ -264,7 +264,7 @@ wxString clStandardPaths::GetInstallDir() const
 #ifdef __WXGTK__
     return GetBinFolder();
 #else
-#ifdef USE_POSIX_LAYOUT
+#ifdef __WXMSW__
     wxFileName path(wxStandardPaths::Get().GetDataDir(), "");
     return path.GetPath();
 #else
@@ -275,7 +275,7 @@ wxString clStandardPaths::GetInstallDir() const
 
 void clStandardPaths::IgnoreAppSubDir(const wxString& subdirPattern)
 {
-#ifdef USE_POSIX_LAYOUT
+#ifdef __WXMSW__
     wxStandardPaths::Get().IgnoreAppSubDir(subdirPattern);
 #endif
 }
diff --git a/Debugger/CMakeLists.txt b/Debugger/CMakeLists.txt
index 31f4da701..523002a5c 100644
--- a/Debugger/CMakeLists.txt
+++ b/Debugger/CMakeLists.txt
@@ -31,7 +31,7 @@ endif()
 set_target_properties(${PLUGIN_NAME} PROPERTIES PREFIX "")
 target_link_libraries(${PLUGIN_NAME} ${LINKER_OPTIONS} libcodelite plugin libgdbparser)
 
-if(MINGW AND WITH_POSIX_LAYOUT)
+if(MINGW)
     install(
         TARGETS DebuggerGDB
         RUNTIME DESTINATION ${PLUGINS_DIR}/debuggers
diff --git a/LiteEditor/CMakeLists.txt b/LiteEditor/CMakeLists.txt
index 11a01a894..beeb09b4f 100644
--- a/LiteEditor/CMakeLists.txt
+++ b/LiteEditor/CMakeLists.txt
@@ -227,20 +227,13 @@ if(NOT APPLE)
         install(
             CODE "execute_process(COMMAND rm -f \$ENV{DESTDIR}/${CMAKE_INSTALL_PREFIX}/share/icons/hicolor/icon-theme.cache)"
         )
-    elseif(MINGW AND WITH_POSIX_LAYOUT)
+    elseif(MINGW)
         install(
             FILES ${CL_SRC_ROOT}/art/splashscreen@2x.png
             DESTINATION ${CMAKE_INSTALL_PREFIX}/share/codelite/images
             RENAME splashscreen.png)
 
         install(FILES ${CL_SRC_ROOT}/art/splashscreen@2x.png DESTINATION ${CMAKE_INSTALL_PREFIX}/share/codelite/images)
-    elseif(MINGW)
-        install(
-            FILES ${CL_SRC_ROOT}/art/splashscreen@2x.png
-            DESTINATION ${CL_INSTALL_BIN}/images
-            RENAME splashscreen.png)
-
-        install(FILES ${CL_SRC_ROOT}/art/splashscreen@2x.png DESTINATION ${CL_INSTALL_BIN}/images)
     endif()
 
     codelite_install_script(${CL_SRC_ROOT}/Runtime/codelite-remote)
diff --git a/LiteEditor/app.cpp b/LiteEditor/app.cpp
index f2ce69a6c..a6798b915 100644
--- a/LiteEditor/app.cpp
+++ b/LiteEditor/app.cpp
@@ -508,15 +508,11 @@ bool CodeLiteApp::OnInit()
         }
         homeDir = bd.GetPath();
     } else {
-#ifdef USE_POSIX_LAYOUT
         wxFileName execfpath(clStandardPaths::Get().GetExecutablePath());
         if (execfpath.GetDirs().Last().IsSameAs("bin")) {
             execfpath.RemoveLastDir();
         }
         homeDir = execfpath.GetPath() + wxT("/share/codelite");
-#else
-        homeDir = wxFileName(wxStandardPaths::Get().GetExecutablePath()).GetPath();
-#endif
     }
     clStandardPaths::Get().SetDataDir(homeDir);
 #endif
@@ -599,11 +595,7 @@ bool CodeLiteApp::OnInit()
 
 #else //__WXMSW__
     if (homeDir.IsEmpty()) { // did we got a basedir from user?
-#ifdef USE_POSIX_LAYOUT
         homeDir = clStandardPaths::Get().GetDataDir();
-#else
-        homeDir = ::wxGetCwd();
-#endif
     }
     wxFileName fnHomeDir(homeDir, "");
 
@@ -738,11 +730,7 @@ bool CodeLiteApp::OnInit()
         wxLocale::AddCatalogLookupPathPrefix(wxT("/usr/local/share/locale"));
 
 #elif defined(__WXMSW__)
-#ifdef USE_POSIX_LAYOUT
         wxLocale::AddCatalogLookupPathPrefix(clStandardPaths::Get().GetInstallDir() + wxT("\\share\\locale"));
-#else
-        wxLocale::AddCatalogLookupPathPrefix(ManagerST::Get()->GetInstallDir() + wxT("\\locale"));
-#endif
 #endif
 
         // This has to be done before the catalogues are added, as otherwise the wrong one (or none) will be found
diff --git a/LiteEditor/frame.cpp b/LiteEditor/frame.cpp
index 7c4397d6e..1e67d9e65 100644
--- a/LiteEditor/frame.cpp
+++ b/LiteEditor/frame.cpp
@@ -3478,7 +3478,7 @@ void clMainFrame::CompleteInitialization()
     m_chatAI = std::make_unique<ChatAI>();
 
 // Load debuggers (*must* be after the plugins)
-#ifdef USE_POSIX_LAYOUT
+#ifdef __WXMSW__
     wxString plugdir(clStandardPaths::Get().GetPluginsDirectory());
     DebuggerMgr::Get().Initialize(this, EnvironmentConfig::Instance(), plugdir);
 #else
diff --git a/Plugin/Debugger/debuggermanager.cpp b/Plugin/Debugger/debuggermanager.cpp
index c12befb3d..0c02e150d 100644
--- a/Plugin/Debugger/debuggermanager.cpp
+++ b/Plugin/Debugger/debuggermanager.cpp
@@ -103,11 +103,7 @@ bool DebuggerMgr::LoadDebuggers(IDebuggerObserver* observer)
     wxString debuggersPath(PLUGINS_DIR, wxConvUTF8);
     debuggersPath += wxT("/debuggers");
 #elif defined(__WXMSW__)
-#ifdef USE_POSIX_LAYOUT
     wxString debuggersPath(clStandardPaths::Get().GetPluginsDirectory() + wxT("/debuggers"));
-#else
-    wxString debuggersPath(m_baseDir + wxT("/debuggers"));
-#endif
 #else
     // OSX
     wxFileName debuggersFolder(clStandardPaths::Get().GetDataDir(), "");
diff --git a/translations/CMakeLists.txt b/translations/CMakeLists.txt
index 2061007e8..ac87622bf 100644
--- a/translations/CMakeLists.txt
+++ b/translations/CMakeLists.txt
@@ -2,11 +2,7 @@ find_package(Gettext)
 
 if (GETTEXT_FOUND)
 
-    if (NOT MINGW OR WITH_POSIX_LAYOUT)
-        set(INSTALL_LANG_DIR ${CMAKE_INSTALL_PREFIX}/share/locale)
-    else()
-        set(INSTALL_LANG_DIR ${CMAKE_INSTALL_PREFIX}/locale)
-    endif()
+    set(INSTALL_LANG_DIR ${CMAKE_INSTALL_PREFIX}/share/locale)
 
 # 2 issues with GETTEXT_PROCESS_PO_FILES:
 # - gitlab.kitware.com/cmake/cmake/-/issues/14904: Gettext module does not allow installing .po files with the same name from different directories
diff --git a/wxcrafter/src/wxgui_bitmaploader.cpp b/wxcrafter/src/wxgui_bitmaploader.cpp
index 9687f49af..7d9eef8f3 100644
--- a/wxcrafter/src/wxgui_bitmaploader.cpp
+++ b/wxcrafter/src/wxgui_bitmaploader.cpp
@@ -14,7 +14,7 @@ wxCrafter::ResourceLoader::ResourceLoader(const wxString& skin)
 {
     if(m_bitmaps.empty()) {
         wxString zipFile;
-#ifdef USE_POSIX_LAYOUT
+#ifdef __WXMSW__
         zipFile << wxStandardPaths::Get().GetDataDir() << wxT(INSTALL_DIR) << wxFileName::GetPathSeparator() << skin
                 << wxT(".zip");
 #else
-- 
2.48.1.windows.1


From eb0c1b78ce72ae322c8fab5755d255e5c84791f2 Mon Sep 17 00:00:00 2001
From: Naveen M K <naveen521kk@gmail.com>
Date: Tue, 20 Jun 2023 20:35:27 +0530
Subject: [PATCH 059/N] ssl module: add MINGW support

---
 Modules/_ssl.c          | 4 ++--
 Modules/clinic/_ssl.c.h | 8 ++++----
 configure.ac            | 2 +-
 3 files changed, 7 insertions(+), 7 deletions(-)

diff --git a/Modules/_ssl.c b/Modules/_ssl.c
index 417d5ca..9d0a73d 100644
--- a/Modules/_ssl.c
+++ b/Modules/_ssl.c
@@ -5963,7 +5963,7 @@ _ssl_nid2obj_impl(PyObject *module, int nid)
     return result;
 }
 
-#ifdef _MSC_VER
+#ifdef _WIN32
 
 static PyObject*
 certEncodingType(DWORD encodingType)
@@ -6282,7 +6282,7 @@ _ssl_enum_crls_impl(PyObject *module, const char *store_name)
     }
 }
 
-#endif /* _MSC_VER */
+#endif /* _WIN32 */
 
 /* List of functions exported by this module. */
 static PyMethodDef PySSL_methods[] = {
diff --git a/Modules/clinic/_ssl.c.h b/Modules/clinic/_ssl.c.h
index 6c6ef4c..e39466f 100644
--- a/Modules/clinic/_ssl.c.h
+++ b/Modules/clinic/_ssl.c.h
@@ -2733,7 +2733,7 @@ exit:
     return return_value;
 }
 
-#if defined(_MSC_VER)
+#if defined(_WIN32)
 
 PyDoc_STRVAR(_ssl_enum_certificates__doc__,
 "enum_certificates($module, /, store_name)\n"
@@ -2813,9 +2813,9 @@ exit:
     return return_value;
 }
 
-#endif /* defined(_MSC_VER) */
+#endif /* defined(_WIN32) */
 
-#if defined(_MSC_VER)
+#if defined(_WIN32)
 
 PyDoc_STRVAR(_ssl_enum_crls__doc__,
 "enum_crls($module, /, store_name)\n"
@@ -2894,7 +2894,7 @@ exit:
     return return_value;
 }
 
-#endif /* defined(_MSC_VER) */
+#endif /* defined(_WIN32) */
 
 #ifndef _SSL_ENUM_CERTIFICATES_METHODDEF
     #define _SSL_ENUM_CERTIFICATES_METHODDEF
diff --git a/configure.ac b/configure.ac
index 33293d1..f62978a 100644
--- a/configure.ac
+++ b/configure.ac
@@ -8570,7 +8570,7 @@ PY_STDLIB_MOD([_zstd], [], [test "$have_libzstd" = yes],
 
 dnl OpenSSL bindings
 PY_STDLIB_MOD([_ssl], [], [test "$ac_cv_working_openssl_ssl" = yes],
-  [$OPENSSL_INCLUDES], [$OPENSSL_LDFLAGS $OPENSSL_LDFLAGS_RPATH $OPENSSL_LIBS])
+  [$OPENSSL_INCLUDES], [$OPENSSL_LDFLAGS $OPENSSL_LDFLAGS_RPATH $OPENSSL_LIBS -lws2_32 -lcrypt32])
 PY_STDLIB_MOD([_hashlib], [], [test "$ac_cv_working_openssl_hashlib" = yes],
   [$OPENSSL_INCLUDES], [$OPENSSL_LDFLAGS $OPENSSL_LDFLAGS_RPATH $LIBCRYPTO_LIBS])
 

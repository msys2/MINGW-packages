From e1ca422316d6ebe37fc91dd1e227f43347a044ec Mon Sep 17 00:00:00 2001
From: ozone10 <positronix10@gmail.com>
Date: Wed, 28 Jan 2026 18:15:17 +0100
Subject: [PATCH] Fix msys2 clang build

---
 .github/workflows/CI_build.yml                | 26 +++---
 PowerEditor/gcc/makefile                      | 19 +++--
 PowerEditor/src/MISC/Common/Common.cpp        | 17 ++--
 PowerEditor/src/MISC/sha1/sha1.h              |  4 +-
 PowerEditor/src/Notepad_plus.cpp              |  2 +-
 PowerEditor/src/NppLibsVersionH-generator.bat |  3 +
 PowerEditor/src/Parameters.h                  |  8 +-
 .../src/ScintillaComponent/AutoCompletion.cpp |  4 +-
 .../src/ScintillaComponent/FindReplaceDlg.cpp |  8 +-
 .../ScintillaComponent/FunctionCallTip.cpp    |  4 +-
 .../src/ScintillaComponent/FunctionCallTip.h  |  2 +-
 .../DockingWnd/DockingDlgInterface.h          | 18 ++--
 .../src/WinControls/FileBrowser/fileBrowser.h | 17 ++--
 .../WinControls/StaticDialog/StaticDialog.cpp | 85 +++++++++++--------
 .../WinControls/StaticDialog/StaticDialog.h   | 14 +--
 .../src/WinControls/StatusBar/StatusBar.cpp   | 34 +++++---
 .../src/WinControls/StatusBar/StatusBar.h     | 19 +++--
 .../src/WinControls/WindowsDlg/WindowsDlg.cpp |  2 +-
 PowerEditor/src/localization.cpp              |  9 +-
 19 files changed, 169 insertions(+), 126 deletions(-)

diff --git a/.github/workflows/CI_build.yml b/.github/workflows/CI_build.yml
index 74e0698cd516..11c5f222242b 100644
--- a/.github/workflows/CI_build.yml
+++ b/.github/workflows/CI_build.yml
@@ -170,35 +170,35 @@ jobs:
 
     - name: Archive artifacts for x64 / Release
       if: matrix.build_platform == 'x64' && matrix.build_configuration == 'Release'
-      uses: actions/upload-artifact@v5
+      uses: actions/upload-artifact@v6
       with:
           name: Notepad++.MSVC.${{ matrix.build_platform}}.${{ matrix.build_configuration}}
           path: PowerEditor\bin64\Notepad++.exe
 
     - name: Archive artifacts for Win32 / Release
       if: matrix.build_platform == 'Win32' && matrix.build_configuration == 'Release'
-      uses: actions/upload-artifact@v5
+      uses: actions/upload-artifact@v6
       with:
           name: Notepad++.MSVC.${{ matrix.build_platform}}.${{ matrix.build_configuration}}
           path: PowerEditor\bin\Notepad++.exe
 
     - name: Archive artifacts for ARM64 / Release
       if: matrix.build_platform == 'ARM64' && matrix.build_configuration == 'Release'
-      uses: actions/upload-artifact@v5
+      uses: actions/upload-artifact@v6
       with:
           name: Notepad++.MSVC.${{ matrix.build_platform}}.${{ matrix.build_configuration}}
           path: PowerEditor\binarm64\Notepad++.exe
 
     - name: Archive artifacts for ARM64|x64 / Debug
       if: (matrix.build_platform == 'ARM64' || matrix.build_platform == 'x64') && matrix.build_configuration == 'Debug'
-      uses: actions/upload-artifact@v5
+      uses: actions/upload-artifact@v6
       with:
           name: Notepad++.MSVC.${{ matrix.build_platform}}.${{ matrix.build_configuration}}
           path: PowerEditor\visual.net\${{ matrix.build_platform}}\${{ matrix.build_configuration}}\Notepad++.exe
 
     - name: Archive artifacts for Win32 / Debug
       if: matrix.build_platform == 'Win32' && matrix.build_configuration == 'Debug'
-      uses: actions/upload-artifact@v5
+      uses: actions/upload-artifact@v6
       with:
           name: Notepad++.MSVC.${{ matrix.build_platform}}.${{ matrix.build_configuration}}
           path: PowerEditor\visual.net\${{ matrix.build_configuration}}\Notepad++.exe
@@ -336,6 +336,7 @@ jobs:
     strategy:
       fail-fast: false
       matrix:
+        build_compiler: [gcc]
         build_configuration: [Release, Debug]
         build_platform: [x86_64, i686]
 
@@ -351,7 +352,8 @@ jobs:
            $newContent = $content -replace 'TEXT\(\"Notepad\+\+ v.*\"\)', 'TEXT("Notepad++ GH_BUILD")'
            $newContent | Set-Content -Path 'resource.h'
 
-    - name: Make n++ exe
+    - name: Make n++ exe / gcc
+      if: matrix.build_compiler == 'gcc'
       working-directory: .\
       run: |
         Write-host "${{ matrix.build_platform }}"
@@ -374,14 +376,14 @@ jobs:
 
     - name: Archive artifacts for ${{ matrix.build_platform}} / Release
       if: matrix.build_configuration == 'Release'
-      uses: actions/upload-artifact@v5
+      uses: actions/upload-artifact@v6
       with:
-          name: Notepad++.GCC.${{ matrix.build_platform}}.${{ matrix.build_configuration}}
-          path: bin.${{ matrix.build_platform}}\notepad++.exe
+          name: Notepad++.${{ matrix.build_compiler}}.${{ matrix.build_platform}}.${{ matrix.build_configuration}}
+          path: bin.${{ matrix.build_compiler}}.${{ matrix.build_platform}}\notepad++.exe
 
     - name: Archive artifacts for ${{ matrix.build_platform}} / Debug
       if: matrix.build_configuration == 'Debug'
-      uses: actions/upload-artifact@v5
+      uses: actions/upload-artifact@v6
       with:
-          name: Notepad++.GCC.${{ matrix.build_platform}}.${{ matrix.build_configuration}}
-          path: bin.${{ matrix.build_platform}}-debug\notepad++.exe
+          name: Notepad++.${{ matrix.build_compiler}}.${{ matrix.build_platform}}.${{ matrix.build_configuration}}
+          path: bin.${{ matrix.build_compiler}}.${{ matrix.build_platform}}-debug\notepad++.exe
diff --git a/PowerEditor/gcc/makefile b/PowerEditor/gcc/makefile
index b0cb1ad087b6..abf28e4950a0 100644
--- a/PowerEditor/gcc/makefile
+++ b/PowerEditor/gcc/makefile
@@ -18,6 +18,8 @@
 # definitions
 #
 
+MAKEFILE_ABS_DIR = $(abspath $(dir $(lastword $(MAKEFILE_LIST))))
+
 GCC_DIRECTORY := ../gcc
 GCC_EXCLUDE := $(GCC_DIRECTORY)/gcc-%
 SRC_DIRECTORY := ../src
@@ -38,8 +40,11 @@ LEXILLA_TARGET := liblexilla.a
 
 ifeq ($(CXX),clang++)
   CXX := $(CROSS_COMPILE)clang++
+  SCI_CLANG := 1
+  COMPILER_SUFFIX := clang.
 else
   CXX := $(CROSS_COMPILE)g++
+  COMPILER_SUFFIX := gcc.
 endif
 
 CXXFLAGS := -include $(GCC_DIRECTORY)/gcc-fixes.h -std=c++20
@@ -91,7 +96,9 @@ ifeq ($(CXX),clang++)
               -Wno-overloaded-virtual \
               -Wno-sign-conversion \
               -Wno-c99-extensions \
-              -Wno-deprecated-declarations
+              -Wno-deprecated-declarations \
+              -Wno-nested-anon-types \
+              -Wno-cast-align
 else ifeq ($(BUILD_TYPE),release)
   CXXFLAGS += -Wno-alloc-size-larger-than
 endif
@@ -135,7 +142,7 @@ export RC += -Fpe-x86-64
 endif
 
 # define target and build directories and update dependent variables
-TARGET_DIRECTORY := bin.$(TARGET_CPU)$(BUILD_SUFFIX)
+TARGET_DIRECTORY := bin.$(COMPILER_SUFFIX)$(TARGET_CPU)$(BUILD_SUFFIX)
 BUILD_DIRECTORY := $(TARGET_DIRECTORY).build
 
 TARGET_BINARY := $(TARGET_DIRECTORY)/$(TARGET_BINARY)
@@ -195,7 +202,7 @@ CPDIR := cp -r
 RMDIR := rm -rf
 CP := cp
 RM := rm -f
-PREBUILD_EVENT_CMD := cmd //C "cd PowerEditor/src && NppLibsVersionH-generator.bat"
+PREBUILD_EVENT_CMD := cmd //C "$(MAKEFILE_ABS_DIR)/../src/NppLibsVersionH-generator.bat"
 normalize-path = $1
 else ifneq "$(wildcard $(dir $(SHELL))ls.exe)" ""
 # a Windows system with a proper shell
@@ -207,7 +214,7 @@ CPDIR := $(SHELL_DIRECTORY)cp.exe -r
 RMDIR := $(SHELL_DIRECTORY)rm.exe -rf
 CP := $(SHELL_DIRECTORY)cp.exe
 RM := $(SHELL_DIRECTORY)rm.exe -f
-PREBUILD_EVENT_CMD := cmd //C "cd PowerEditor/src && NppLibsVersionH-generator.bat"
+PREBUILD_EVENT_CMD := cmd //C "$(MAKEFILE_ABS_DIR)/../src/NppLibsVersionH-generator.bat"
 normalize-path = $1
 else
 # a standard Windows system
@@ -269,10 +276,10 @@ $(LEXILLA_TARGET): .force
 endif
 
 $(SCINTILLA_TARGET): | $(BUILD_DIRECTORY) $(SCINTILLA_BUILD_DIRECTORY)
-	$(AT)$(MAKE) $(SUBMAKEFLAGS) -C $(SCINTILLA_DIRECTORY)/win32 -f makefile -f ../../boostregex/nppSpecifics_mingw.mak DIR_O=$(SCINTILLA_BUILD_PATH) LIBSCI=$(SCINTILLA_TARGET_PATH) $(SCINTILLA_TARGET_PATH)
+	$(AT)$(MAKE) $(SUBMAKEFLAGS) -C $(SCINTILLA_DIRECTORY)/win32 -f makefile -f ../../boostregex/nppSpecifics_mingw.mak DIR_O=$(SCINTILLA_BUILD_PATH) LIBSCI=$(SCINTILLA_TARGET_PATH) $(SCINTILLA_TARGET_PATH) CLANG=$(SCI_CLANG)
 
 $(LEXILLA_TARGET): | $(BUILD_DIRECTORY) $(LEXILLA_BUILD_DIRECTORY)
-	$(AT)$(MAKE) $(SUBMAKEFLAGS) -C $(LEXILLA_DIRECTORY)/src DIR_O=$(LEXILLA_BUILD_PATH) LIBLEXILLA=$(LEXILLA_TARGET_PATH) $(LEXILLA_TARGET_PATH)
+	$(AT)$(MAKE) $(SUBMAKEFLAGS) -C $(LEXILLA_DIRECTORY)/src DIR_O=$(LEXILLA_BUILD_PATH) LIBLEXILLA=$(LEXILLA_TARGET_PATH) $(LEXILLA_TARGET_PATH) CLANG=$(SCI_CLANG)
 
 binary: $(TARGET_BINARY) data
 	@echo +++ $(TARGET_CPU) $(BUILD_TYPE) : $(CURDIR)/$(TARGET_BINARY) +++
diff --git a/PowerEditor/src/MISC/Common/Common.cpp b/PowerEditor/src/MISC/Common/Common.cpp
index 6af851847c25..79f0af7ad438 100644
--- a/PowerEditor/src/MISC/Common/Common.cpp
+++ b/PowerEditor/src/MISC/Common/Common.cpp
@@ -833,7 +833,7 @@ std::wstring stringToUpper(std::wstring strToConvert)
 {
 	static const auto loc = std::locale("");
 	std::transform(strToConvert.begin(), strToConvert.end(), strToConvert.begin(),
-		[](wchar_t ch) { return std::toupper(ch, loc); });
+		[](auto ch) { return std::toupper(ch, loc); });
 	return strToConvert;
 }
 
@@ -841,7 +841,7 @@ std::wstring stringToLower(std::wstring strToConvert)
 {
 	static const auto loc = std::locale("");
 	std::transform(strToConvert.begin(), strToConvert.end(), strToConvert.begin(),
-		[](wchar_t ch) { return std::tolower(ch, loc); });
+		[](auto ch) { return std::tolower(ch, loc); });
 	return strToConvert;
 }
 
@@ -1754,7 +1754,7 @@ bool isUnsupportedFileName(const wstring& fileName)
 				// upperize because the std::find is case sensitive unlike the Windows OS filesystem
 				static const auto& loc = std::locale::classic();
 				std::transform(fileNameOnly.begin(), fileNameOnly.end(), fileNameOnly.begin(),
-					[](wchar_t ch) { return std::toupper(ch, loc); });
+					[](auto ch) { return std::toupper(ch, loc); });
 
 				const std::vector<std::wstring> reservedWin32NamespaceDeviceList {
 				L"CON", L"PRN", L"AUX", L"NUL",
@@ -2111,11 +2111,12 @@ bool doesPathExist(const wchar_t* path, DWORD milliSec2wait, bool* isTimeoutReac
 	return (attributes.dwFileAttributes != INVALID_FILE_ATTRIBUTES);
 }
 
-
-#if defined(__GNUC__)
-#define LAMBDA_STDCALL __attribute__((__stdcall__))
+#if defined(__GNUC__) && __GNUC__ > 8
+#define WINAPI_LAMBDA_RETURN(return_t) -> return_t WINAPI
+#elif defined(__GNUC__)
+#define WINAPI_LAMBDA_RETURN(return_t) WINAPI -> return_t
 #else
-#define LAMBDA_STDCALL 
+#define WINAPI_LAMBDA_RETURN(return_t) -> return_t
 #endif
 
 // check if the window rectangle intersects with any currently active monitor's working area
@@ -2129,7 +2130,7 @@ bool isWindowVisibleOnAnyMonitor(const RECT& rectWndIn)
 	};
 
 	// callback func to check for intersection with each existing monitor
-	auto callback = []([[maybe_unused]] HMONITOR hMon, [[maybe_unused]] HDC hdc, LPRECT lprcMon, LPARAM lpInOut) -> BOOL LAMBDA_STDCALL
+	auto callback = []([[maybe_unused]] HMONITOR hMon, [[maybe_unused]] HDC hdc, LPRECT lprcMon, LPARAM lpInOut) WINAPI_LAMBDA_RETURN(BOOL)
 	{
 		Param4InOut* paramInOut = reinterpret_cast<Param4InOut*>(lpInOut);
 		RECT rectIntersection{};
diff --git a/PowerEditor/src/MISC/sha1/sha1.h b/PowerEditor/src/MISC/sha1/sha1.h
index a1b73fbe8fe4..becd5314d48c 100644
--- a/PowerEditor/src/MISC/sha1/sha1.h
+++ b/PowerEditor/src/MISC/sha1/sha1.h
@@ -247,10 +247,10 @@ class CSHA1
 	// Member variables
 	UINT_32 m_state[5];
 	UINT_32 m_count[2];
-	UINT_32 m_reserved0[1]; // Memory alignment padding
+	[[maybe_unused]] UINT_32 m_reserved0[1]; // Memory alignment padding
 	UINT_8 m_buffer[64];
 	UINT_8 m_digest[20];
-	UINT_32 m_reserved1[3]; // Memory alignment padding
+	[[maybe_unused]] UINT_32 m_reserved1[3]; // Memory alignment padding
 
 	UINT_8 m_workspace[64];
 	SHA1_WORKSPACE_BLOCK* m_block; // SHA1 pointer to the byte array above
diff --git a/PowerEditor/src/Notepad_plus.cpp b/PowerEditor/src/Notepad_plus.cpp
index c832c13b1c33..81dcbd3526d6 100644
--- a/PowerEditor/src/Notepad_plus.cpp
+++ b/PowerEditor/src/Notepad_plus.cpp
@@ -3097,7 +3097,7 @@ void Notepad_plus::setUniModeText()
 		int cmdID = em.getIndexFromEncoding(encoding);
 		if (cmdID == -1)
 		{
-			assert(!"Encoding problem. Encoding is not added in encoding_table?");
+			assert(false && "Encoding problem. Encoding is not added in encoding_table?");
 			return;
 		}
 		cmdID += IDM_FORMAT_ENCODE;
diff --git a/PowerEditor/src/NppLibsVersionH-generator.bat b/PowerEditor/src/NppLibsVersionH-generator.bat
index 709606602e83..4ddde3f01535 100644
--- a/PowerEditor/src/NppLibsVersionH-generator.bat
+++ b/PowerEditor/src/NppLibsVersionH-generator.bat
@@ -1,5 +1,8 @@
 @echo off
 
+setlocal
+cd /d %~dp0
+
 rem If this batch file is called from the Microsoft Visual Studio pre-build event,
 rem then the current dir for this bat-file is set to Notepad++ solution/project dir.
 rem Because in this batch file we have to go two dir-levels higher (for finding the files
diff --git a/PowerEditor/src/Parameters.h b/PowerEditor/src/Parameters.h
index 177f0450e21e..481317c3d5b4 100644
--- a/PowerEditor/src/Parameters.h
+++ b/PowerEditor/src/Parameters.h
@@ -370,8 +370,8 @@ struct GlobalOverride final
 
 struct StyleArray
 {
-	const auto begin() const { return _styleVect.begin(); }
-	const auto end() const { return _styleVect.end(); }
+	auto begin() const { return _styleVect.begin(); }
+	auto end() const { return _styleVect.end(); }
 	auto begin() { return _styleVect.begin(); }
 	auto end() { return _styleVect.end(); }
 	void clear() { _styleVect.clear(); }
@@ -420,7 +420,9 @@ struct StyleArray
 struct LexerStyler : public StyleArray
 {
 public:
-	LexerStyler & operator=(const LexerStyler & ls)
+	LexerStyler() noexcept = default;
+	LexerStyler(const LexerStyler& ls) noexcept = default;
+	LexerStyler& operator=(const LexerStyler& ls)
 	{
 		if (this != &ls)
 		{
diff --git a/PowerEditor/src/ScintillaComponent/AutoCompletion.cpp b/PowerEditor/src/ScintillaComponent/AutoCompletion.cpp
index dd1bd792cf0c..796cfab2bfe9 100644
--- a/PowerEditor/src/ScintillaComponent/AutoCompletion.cpp
+++ b/PowerEditor/src/ScintillaComponent/AutoCompletion.cpp
@@ -281,7 +281,7 @@ static bool isAllDigits(const std::string& str)
 {
 	static const auto& loc = std::locale::classic();
 	return std::all_of(str.begin(), str.end(),
-		[](unsigned char c) { return std::isdigit(c, loc); });
+		[](auto c) { return std::isdigit(c, loc); });
 }
 
 static void sortInsensitive(std::vector<std::string>& wordArray)
@@ -295,7 +295,7 @@ static void sortInsensitive(std::vector<std::string>& wordArray)
 			return lexicographical_compare(
 				a.begin(), a.end(),
 				b.begin(), b.end(),
-				[](const unsigned char &ch1, const unsigned char &ch2)
+				[](const auto &ch1, const auto &ch2)
 				{
 					return std::toupper(ch1, loc) < std::toupper(ch2, loc);
 				}
diff --git a/PowerEditor/src/ScintillaComponent/FindReplaceDlg.cpp b/PowerEditor/src/ScintillaComponent/FindReplaceDlg.cpp
index 0a09243e8541..69afc878e971 100644
--- a/PowerEditor/src/ScintillaComponent/FindReplaceDlg.cpp
+++ b/PowerEditor/src/ScintillaComponent/FindReplaceDlg.cpp
@@ -4871,7 +4871,7 @@ void FindReplaceDlg::doDialog(DIALOG_TYPE whichType, bool isRTL, bool toShow)
 		enableReplaceFunc(whichType == REPLACE_DLG);
 
 	::SetFocus(toShow ? ::GetDlgItem(_hSelf, IDFINDWHAT) : (*_ppEditView)->getHSelf());
-	display(toShow, true);
+	StaticDialog::displayEnhanced(toShow);
 }
 
 LRESULT CALLBACK FindReplaceDlg::FinderProc(
@@ -4942,9 +4942,9 @@ LRESULT CALLBACK FindReplaceDlg::FinderProc(
 	return ::DefSubclassProc(hWnd, uMsg, wParam, lParam);
 }
 
-bool isUnexpectedInvisible(wchar_t ch)
+static bool isUnexpectedInvisible(wchar_t ch)
 {
-	if (ch >= 0x0000 && ch <= 0x001F) // includ EOL
+	if (ch <= 0x001F) // includ EOL
 	{
 		return (ch != L'\t'); // Tab is not considered as unexpected "invisible" characters 
 	}
@@ -4986,7 +4986,7 @@ bool isUnexpectedInvisible(wchar_t ch)
 	}
 }
 
-bool containsInvisibleChar(const std::wstring& text)
+static bool containsInvisibleChar(const std::wstring& text)
 {
 	for (wchar_t ch : text)
 	{
diff --git a/PowerEditor/src/ScintillaComponent/FunctionCallTip.cpp b/PowerEditor/src/ScintillaComponent/FunctionCallTip.cpp
index d3122b578312..fbe50386221a 100644
--- a/PowerEditor/src/ScintillaComponent/FunctionCallTip.cpp
+++ b/PowerEditor/src/ScintillaComponent/FunctionCallTip.cpp
@@ -55,8 +55,8 @@ static int testNameNoCase(const char* name1, const char* name2, int len = -1)
 
 	for (int i = 0; i < len; ++i)
 	{
-		const unsigned char char1 = name1[i];
-		const unsigned char char2 = name2[i];
+		const char char1 = name1[i];
+		const char char2 = name2[i];
 
 		if (char1 == '\0' || char2 == '\0') // null terminator check
 			return char1 - char2;
diff --git a/PowerEditor/src/ScintillaComponent/FunctionCallTip.h b/PowerEditor/src/ScintillaComponent/FunctionCallTip.h
index a1f776698ade..78cd1d4ed6e4 100644
--- a/PowerEditor/src/ScintillaComponent/FunctionCallTip.h
+++ b/PowerEditor/src/ScintillaComponent/FunctionCallTip.h
@@ -73,7 +73,7 @@ class FunctionCallTip {
 	void showCalltip();				//display calltip based on current variables
 	void reset();					//reset all vars in case function is invalidated
 	void cleanup();					//delete any leftovers
-	static bool isBasicWordChar(unsigned char ch) {
+	static bool isBasicWordChar(char ch) {
 		static const auto& loc = std::locale::classic();
 		return std::isalnum(ch, loc) || ch == '_';
 	}
diff --git a/PowerEditor/src/WinControls/DockingWnd/DockingDlgInterface.h b/PowerEditor/src/WinControls/DockingWnd/DockingDlgInterface.h
index 0fb86357ea3e..eb57f50782ba 100644
--- a/PowerEditor/src/WinControls/DockingWnd/DockingDlgInterface.h
+++ b/PowerEditor/src/WinControls/DockingWnd/DockingDlgInterface.h
@@ -17,17 +17,19 @@
 
 #pragma once
 
-#include "dockingResource.h"
-#include "Docking.h"
+#include <windows.h>
 
-#include <array>
-#include <assert.h>
 #include <shlwapi.h>
-#include "Common.h"
-#include "StaticDialog.h"
-#include "NppDarkMode.h"
 
+#include <array>
+#include <cassert>
+#include <string>
 
+#include "Docking.h"
+#include "Notepad_plus_msgs.h"
+#include "NppDarkMode.h"
+#include "StaticDialog.h"
+#include "dockingResource.h"
 
 class DockingDlgInterface : public StaticDialog
 {
@@ -101,6 +103,8 @@ protected :
 	bool _isFloating = true;
 	bool _isClosed = false;
 
+	using StaticDialog::create;
+
 	intptr_t CALLBACK run_dlgProc(UINT message, WPARAM wParam, LPARAM lParam) override {
 		switch (message)
 		{
diff --git a/PowerEditor/src/WinControls/FileBrowser/fileBrowser.h b/PowerEditor/src/WinControls/FileBrowser/fileBrowser.h
index f1312db79ec8..1887da547854 100644
--- a/PowerEditor/src/WinControls/FileBrowser/fileBrowser.h
+++ b/PowerEditor/src/WinControls/FileBrowser/fileBrowser.h
@@ -17,6 +17,11 @@
 
 #pragma once
 
+#include <windows.h>
+
+#include <string>
+#include <vector>
+
 #include "DockingDlgInterface.h"
 #include "TreeView.h"
 #include "fileBrowser_rc.h"
@@ -35,8 +40,6 @@
 
 #define FOLDERASWORKSPACE_NODE "FolderAsWorkspace"
 
-
-class TiXmlNode;
 class FileBrowser;
 class FolderInfo;
 
@@ -48,12 +51,12 @@ friend class FolderInfo;
 public:
 	FileInfo() = delete; // constructor by default is forbidden
 	FileInfo(const std::wstring& name, FolderInfo* parent) : _name(name), _parent(parent) {}
-	std::wstring getName() const { return _name; }
+	const std::wstring& getName() const { return _name; }
 	void setName(const std::wstring& name) { _name = name; }
 
 private:
 	std::wstring _name;
-	FolderInfo *_parent = nullptr;
+	[[maybe_unused]] FolderInfo* _parent = nullptr;
 };
 
 
@@ -66,9 +69,9 @@ friend class FolderUpdater;
 	FolderInfo() = delete; // constructor by default is forbidden
 	FolderInfo(const std::wstring& name, FolderInfo* parent) : _name(name), _parent(parent) {}
 	void setRootPath(const std::wstring& rootPath) { _rootPath = rootPath; }
-	std::wstring getRootPath() const { return _rootPath; }
+	const std::wstring& getRootPath() const { return _rootPath; }
 	void setName(const std::wstring& name) { _name = name; }
-	std::wstring getName() const { return _name; }
+	const std::wstring& getName() const { return _name; }
 	void addFile(const std::wstring& fn) { _files.push_back(FileInfo(fn, this)); }
 	void addSubFolder(FolderInfo subDirectoryStructure) { _subFolders.push_back(subDirectoryStructure); }
 
@@ -102,7 +105,7 @@ friend class FileBrowser;
 	FileBrowser* _pFileBrowser = nullptr;
 	HANDLE _watchThreadHandle = nullptr;
 	HANDLE _EventHandle = nullptr;
-	static DWORD WINAPI watching(void *param);
+	static DWORD WINAPI watching(void* params);
 
 	static void processChange(DWORD dwAction, std::vector<std::wstring> filesToChange, FolderUpdater* thisFolderUpdater);
 };
diff --git a/PowerEditor/src/WinControls/StaticDialog/StaticDialog.cpp b/PowerEditor/src/WinControls/StaticDialog/StaticDialog.cpp
index 5d9171b5b7d0..0ad813e61f84 100644
--- a/PowerEditor/src/WinControls/StaticDialog/StaticDialog.cpp
+++ b/PowerEditor/src/WinControls/StaticDialog/StaticDialog.cpp
@@ -14,12 +14,20 @@
 // You should have received a copy of the GNU General Public License
 // along with this program.  If not, see <https://www.gnu.org/licenses/>.
 
+
 #include <windows.h>
+
+#include <cstddef>
 #include <cstring>
+#include <cwchar>
+#include <string>
+#include <vector>
 
-#include "StaticDialog.h"
 #include "Common.h"
+#include "Notepad_plus_msgs.h"
 #include "NppDarkMode.h"
+#include "StaticDialog.h"
+#include "Window.h"
 #include "dpiManagerV2.h"
 
 StaticDialog::~StaticDialog()
@@ -109,49 +117,52 @@ bool StaticDialog::moveForDpiChange()
 	return false;
 }
 
-void StaticDialog::display(bool toShow, bool enhancedPositioningCheckWhenShowing) const
+void StaticDialog::display(bool toShow) const
 {
 	if (toShow)
 	{
-		if (enhancedPositioningCheckWhenShowing)
-		{
-			RECT testPositionRc{}, candidateRc{};
+		// If the user has switched from a dual monitor to a single monitor since we last
+		// displayed the dialog, then ensure that it's still visible on the single monitor.
+		RECT workAreaRect{};
+		RECT rc{};
+		::SystemParametersInfo(SPI_GETWORKAREA, 0, &workAreaRect, 0);
+		::GetWindowRect(_hSelf, &rc);
+		int newLeft = rc.left;
+		int newTop = rc.top;
+		int margin = ::GetSystemMetrics(SM_CYSMCAPTION);
+
+		if (newLeft > ::GetSystemMetrics(SM_CXVIRTUALSCREEN) - margin)
+			newLeft -= rc.right - workAreaRect.right;
+		if (newLeft + (rc.right - rc.left) < ::GetSystemMetrics(SM_XVIRTUALSCREEN) + margin)
+			newLeft = workAreaRect.left;
+		if (newTop > ::GetSystemMetrics(SM_CYVIRTUALSCREEN) - margin)
+			newTop -= rc.bottom - workAreaRect.bottom;
+		if (newTop + (rc.bottom - rc.top) < ::GetSystemMetrics(SM_YVIRTUALSCREEN) + margin)
+			newTop = workAreaRect.top;
+
+		if ((newLeft != rc.left) || (newTop != rc.top)) // then the virtual screen size has shrunk
+			::SetWindowPos(_hSelf, nullptr, newLeft, newTop, 0, 0, SWP_NOSIZE | SWP_NOZORDER);
+		else
+			::SendMessageW(_hSelf, DM_REPOSITION, 0, 0);
+	}
+
+	Window::display(toShow);
+}
+
+void StaticDialog::displayEnhanced(bool toShow) const
+{
+	if (toShow)
+	{
+		RECT testPositionRc{}, candidateRc{};
 
-			getWindowRect(testPositionRc);
+		getWindowRect(testPositionRc);
 
-			candidateRc = getViewablePositionRect(testPositionRc);
+		candidateRc = getViewablePositionRect(testPositionRc);
 
-			if ((testPositionRc.left != candidateRc.left) || (testPositionRc.top != candidateRc.top))
-			{
-				::MoveWindow(_hSelf, candidateRc.left, candidateRc.top, 
-					candidateRc.right - candidateRc.left, candidateRc.bottom - candidateRc.top, TRUE);
-			}
-		}
-		else
+		if ((testPositionRc.left != candidateRc.left) || (testPositionRc.top != candidateRc.top))
 		{
-			// If the user has switched from a dual monitor to a single monitor since we last
-			// displayed the dialog, then ensure that it's still visible on the single monitor.
-			RECT workAreaRect{};
-			RECT rc{};
-			::SystemParametersInfo(SPI_GETWORKAREA, 0, &workAreaRect, 0);
-			::GetWindowRect(_hSelf, &rc);
-			int newLeft = rc.left;
-			int newTop = rc.top;
-			int margin = ::GetSystemMetrics(SM_CYSMCAPTION);
-
-			if (newLeft > ::GetSystemMetrics(SM_CXVIRTUALSCREEN) - margin)
-				newLeft -= rc.right - workAreaRect.right;
-			if (newLeft + (rc.right - rc.left) < ::GetSystemMetrics(SM_XVIRTUALSCREEN) + margin)
-				newLeft = workAreaRect.left;
-			if (newTop > ::GetSystemMetrics(SM_CYVIRTUALSCREEN) - margin)
-				newTop -= rc.bottom - workAreaRect.bottom;
-			if (newTop + (rc.bottom - rc.top) < ::GetSystemMetrics(SM_YVIRTUALSCREEN) + margin)
-				newTop = workAreaRect.top;
-
-			if ((newLeft != rc.left) || (newTop != rc.top)) // then the virtual screen size has shrunk
-				::SetWindowPos(_hSelf, nullptr, newLeft, newTop, 0, 0, SWP_NOSIZE | SWP_NOZORDER);
-			else
-				::SendMessageW(_hSelf, DM_REPOSITION, 0, 0);
+			::MoveWindow(_hSelf, candidateRc.left, candidateRc.top,
+				candidateRc.right - candidateRc.left, candidateRc.bottom - candidateRc.top, TRUE);
 		}
 	}
 
diff --git a/PowerEditor/src/WinControls/StaticDialog/StaticDialog.h b/PowerEditor/src/WinControls/StaticDialog/StaticDialog.h
index d64379cf3847..ca2666a790f5 100644
--- a/PowerEditor/src/WinControls/StaticDialog/StaticDialog.h
+++ b/PowerEditor/src/WinControls/StaticDialog/StaticDialog.h
@@ -14,12 +14,13 @@
 // You should have received a copy of the GNU General Public License
 // along with this program.  If not, see <https://www.gnu.org/licenses/>.
 
+
 #pragma once
-#include "dpiManagerV2.h"
-#include "Notepad_plus_msgs.h"
-#include "Window.h"
 
-typedef HRESULT (WINAPI * ETDTProc) (HWND, DWORD);
+#include <windows.h>
+
+#include "Window.h"
+#include "dpiManagerV2.h"
 
 enum class PosAlign { left, right, top, bottom };
 
@@ -66,9 +67,10 @@ public :
 	void goToCenter(UINT swpFlags = SWP_SHOWWINDOW);
 	bool moveForDpiChange();
 
-	void display(bool toShow = true, bool enhancedPositioningCheckWhenShowing = false) const;
+	void display(bool toShow = true) const override;
+	void displayEnhanced(bool toShow) const;
 
-	RECT getViewablePositionRect(RECT testRc) const;
+	RECT getViewablePositionRect(RECT testPositionRc) const;
 
 	POINT getTopPoint(HWND hwnd, bool isLeft = true) const;
 
diff --git a/PowerEditor/src/WinControls/StatusBar/StatusBar.cpp b/PowerEditor/src/WinControls/StatusBar/StatusBar.cpp
index e0dfbd6831b3..b8f95f008957 100644
--- a/PowerEditor/src/WinControls/StatusBar/StatusBar.cpp
+++ b/PowerEditor/src/WinControls/StatusBar/StatusBar.cpp
@@ -14,17 +14,25 @@
 // You should have received a copy of the GNU General Public License
 // along with this program.  If not, see <https://www.gnu.org/licenses/>.
 
-#include <stdexcept>
-#include <windows.h>
-#include <commctrl.h>
+
 #include "StatusBar.h"
+
+#include <windows.h>
+
+#include <uxtheme.h>
+#include <vsstyle.h>
+
 #include <algorithm>
 #include <cassert>
-#include "Parameters.h"
-#include "NppDarkMode.h"
-#include <uxtheme.h>
-#include <vssym32.h>
+#include <cstdlib>
+#include <stdexcept>
+#include <string>
+
 #include "DoubleBuffer/DoubleBuffer.h"
+#include "NppConstants.h"
+#include "NppDarkMode.h"
+#include "Window.h"
+#include "dpiManagerV2.h"
 
 //#define IDC_STATUSBAR 789
 
@@ -53,7 +61,7 @@ struct StatusBarSubclassInfo
 	HFONT _hFont = nullptr;
 
 	StatusBarSubclassInfo() = default;
-	StatusBarSubclassInfo(const HFONT& hFont)
+	explicit StatusBarSubclassInfo(const HFONT& hFont) noexcept
 		: _hFont(hFont) {}
 
 	~StatusBarSubclassInfo()
@@ -133,7 +141,7 @@ static LRESULT CALLBACK StatusBarSubclass(HWND hWnd, UINT uMsg, WPARAM wParam, L
 				int between = 0;
 			} borders{};
 
-			SendMessage(hWnd, SB_GETBORDERS, 0, (LPARAM)&borders);
+			::SendMessage(hWnd, SB_GETBORDERS, 0, reinterpret_cast<LPARAM>(&borders));
 
 			const auto style = ::GetWindowLongPtr(hWnd, GWL_STYLE);
 			bool isSizeGrip = style & SBARS_SIZEGRIP;
@@ -147,7 +155,7 @@ static LRESULT CALLBACK StatusBarSubclass(HWND hWnd, UINT uMsg, WPARAM wParam, L
 			for (int i = 0; i < nParts; ++i)
 			{
 				RECT rcPart{};
-				SendMessage(hWnd, SB_GETRECT, i, (LPARAM)&rcPart);
+				::SendMessage(hWnd, SB_GETRECT, i, reinterpret_cast<LPARAM>(&rcPart));
 				if (!::RectVisible(hdc, &rcPart))
 				{
 					continue;
@@ -166,8 +174,8 @@ static LRESULT CALLBACK StatusBarSubclass(HWND hWnd, UINT uMsg, WPARAM wParam, L
 
 				DWORD cchText = 0;
 				cchText = LOWORD(SendMessage(hWnd, SB_GETTEXTLENGTH, i, 0));
-				str.resize(cchText + 1); // technically the std::wstring might not have an internal null character at the end of the buffer, so add one
-				LRESULT lr = SendMessage(hWnd, SB_GETTEXT, i, (LPARAM)&str[0]);
+				str.resize(size_t{ cchText } + 1); // technically the std::wstring might not have an internal null character at the end of the buffer, so add one
+				LRESULT lr = ::SendMessage(hWnd, SB_GETTEXT, i, reinterpret_cast<LPARAM>(str.data()));
 				str.resize(cchText); // remove the extra NULL character
 				bool ownerDraw = false;
 				if (cchText == 0 && (lr & ~(SBT_NOBORDERS | SBT_POPOUT | SBT_RTLREADING)) != 0)
@@ -314,7 +322,7 @@ void StatusBar::destroy()
 }
 
 
-void StatusBar::reSizeTo(const RECT& rc)
+void StatusBar::reSizeTo(RECT& rc)
 {
 	::MoveWindow(_hSelf, rc.left, rc.top, rc.right, rc.bottom, TRUE);
 	adjustParts(rc.right);
diff --git a/PowerEditor/src/WinControls/StatusBar/StatusBar.h b/PowerEditor/src/WinControls/StatusBar/StatusBar.h
index b34475780e02..fdd4b874a760 100644
--- a/PowerEditor/src/WinControls/StatusBar/StatusBar.h
+++ b/PowerEditor/src/WinControls/StatusBar/StatusBar.h
@@ -13,16 +13,17 @@
 //
 // You should have received a copy of the GNU General Public License
 // along with this program.  If not, see <https://www.gnu.org/licenses/>.
+
+
 #pragma once
 
-#ifndef _WIN32_IE
-#define _WIN32_IE	0x0600
-#endif //_WIN32_IE
+#include <windows.h>
 
-#include "Window.h"
-#include "Common.h"
+#include <string>
 #include <vector>
 
+#include "Window.h"
+
 struct StatusBarSubclassInfo;
 
 
@@ -36,11 +37,11 @@ class StatusBar final : public Window
 	bool setPartWidth(int whichPart, int width);
 
 	void destroy() override;
-    virtual void reSizeTo(const RECT& rc);
+	void reSizeTo(RECT& rc) override;
 
 	int getHeight() const override;
 
-    bool setText(const wchar_t* str, int whichPart);
+	bool setText(const wchar_t* str, int whichPart);
 	bool setOwnerDrawText(const wchar_t* str);
 	void adjustParts(int clientWidth);
 
@@ -49,8 +50,8 @@ class StatusBar final : public Window
 	void init(HINSTANCE hInst, HWND hPere) override;
 
 private:
-    std::vector<int> _partWidthArray;
+	std::vector<int> _partWidthArray;
 	int *_lpParts = nullptr;
 	std::wstring _lastSetText;
 	StatusBarSubclassInfo* _pStatusBarInfo = nullptr;
-};
\ No newline at end of file
+};
diff --git a/PowerEditor/src/WinControls/WindowsDlg/WindowsDlg.cpp b/PowerEditor/src/WinControls/WindowsDlg/WindowsDlg.cpp
index 7ca69afe9080..20e9008537a3 100644
--- a/PowerEditor/src/WinControls/WindowsDlg/WindowsDlg.cpp
+++ b/PowerEditor/src/WinControls/WindowsDlg/WindowsDlg.cpp
@@ -275,7 +275,7 @@ void WindowsDlg::init(HINSTANCE hInst, HWND parent, DocTabView *pTab)
 
 void WindowsDlg::init(HINSTANCE hInst, HWND parent)
 {
-	assert(!"Call other initialize method");
+	assert(false && "Call other initialize method");
 	MyBaseClass::init(hInst, parent);
 	_pTab = NULL;
 }
diff --git a/PowerEditor/src/localization.cpp b/PowerEditor/src/localization.cpp
index f58c579c64ea..49b5dc0b860b 100644
--- a/PowerEditor/src/localization.cpp
+++ b/PowerEditor/src/localization.cpp
@@ -290,7 +290,7 @@ std::wstring NativeLangSpeaker::getShortcutNameString(int itemID) const
 	if (!_nativeLang)
 		return L"";
 
-	NppXml::Node node = NppXml::firstChildElement(_nativeLang, "Dialog");
+	NppXml::Element node = NppXml::firstChildElement(_nativeLang, "Dialog");
 	if (!node) return L"";
 
 	node = NppXml::firstChildElement(node, "ShortcutMapper");
@@ -299,14 +299,13 @@ std::wstring NativeLangSpeaker::getShortcutNameString(int itemID) const
 	node = NppXml::firstChildElement(node, "MainCommandNames");
 	if (!node) return L"";
 
-	for (NppXml::Node childNode = NppXml::firstChildElement(node, "Item");
+	for (NppXml::Element childNode = NppXml::firstChildElement(node, "Item");
 		childNode;
 		childNode = NppXml::nextSiblingElement(childNode, "Item"))
 	{
-		NppXml::Element element = NppXml::toElement(childNode);
-		if (int id = NppXml::intAttribute(element, "id", 0); (id == itemID))
+		if (NppXml::intAttribute(childNode, "id", 0) == itemID)
 		{
-			const char* name = NppXml::attribute(element, "name");
+			const char* name = NppXml::attribute(childNode, "name");
 			if (name)
 			{
 				WcharMbcsConvertor& wmc = WcharMbcsConvertor::getInstance();

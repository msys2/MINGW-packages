--- a/lib/runtime/CMakeLists.txt
+++ b/lib/runtime/CMakeLists.txt
@@ -182,7 +182,7 @@
 endif ()
 
 
-if (NOT WIN32)
+if (NOT MSVC)
   add_flangrt_library(flang_rt.runtime STATIC SHARED
     ${sources}
     LINK_LIBRARIES ${Backtrace_LIBRARY}
--- a/lib/runtime/command.cpp
+++ b/lib/runtime/command.cpp
@@ -18,6 +18,9 @@
 
 #ifdef _WIN32
 #include "flang/Common/windows-include.h"
+#endif
+
+#ifdef _MSC_VER
 #include <direct.h>
 #define getcwd _getcwd
 #define unlink _unlink

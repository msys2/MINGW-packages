# Maintainer: Munan Xu <munan@ti.com>

_realname=jimtcl
pkgbase=mingw-w64-${_realname}
pkgname="${MINGW_PACKAGE_PREFIX}-${_realname}"
pkgver=0.83
pkgrel=1
pkgdesc="Jim Tcl: open source small footprint implementation of Tcl (mingw-w64)"
arch=('any')
mingw_arch=('mingw64' 'ucrt64' 'clang64' 'clangarm64')
url="https://jim.tcl.tk"
license=("spdx:BSD-2-Clause")
makedepends=("${MINGW_PACKAGE_PREFIX}-gcc"
             "${MINGW_PACKAGE_PREFIX}-zlib"
             "${MINGW_PACKAGE_PREFIX}-pkgconf"
             "${MINGW_PACKAGE_PREFIX}-tcl")
source=("https://github.com/msteveb/${_realname}/archive/refs/tags/${pkgver}.tar.gz")
sha256sums=('6f2df00009f5ac4ad654c1ae1d2f8ed18191de38d1f5a88a54ea99cc16936686')

prepare() {
  cd "${srcdir}/${_realname}-${pkgver}"
}

build() {
  cd ${_realname}-${pkgver}

  ./configure \
      --prefix=${MINGW_PREFIX} \
      --build=${MINGW_CHOST} \
      --shared
  make
}

package() {
  cd ${_realname}-${pkgver}
  make DESTDIR="${pkgdir}" install

  # bsdtar can't convert non-ascii filenames to UTF-8 when run in
  # non-UTF-8 locale. It proceeds to pack them anyway embedding raw
  # binary filenames in the traditional tar headers.
}

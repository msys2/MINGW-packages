_realname=lal-refactor
pkgbase=mingw-w64-${_realname}
pkgname=${MINGW_PACKAGE_PREFIX}-${_realname}
pkgver=24.0
pkgrel=1
source=("https://github.com/AdaCore/lal-refactor/archive/${pkgver}/lal-refactor-${pkgver}.tar.gz")
sha256sums=('5eac0aa86d18990a147ff748a43a3de6e815b60258889986a3c4d84403fd147f')
makedepends=("${MINGW_PACKAGE_PREFIX}-gcc-ada"
             "${MINGW_PACKAGE_PREFIX}-gprbuild")
depends=("${MINGW_PACKAGE_PREFIX}-adasat"
         "${MINGW_PACKAGE_PREFIX}-libvss"
         "${MINGW_PACKAGE_PREFIX}-libadalang")

pkgver() {
  cd ${_realname}-${pkgver}
  printf "%s.r%s.%s" "$_branch" "$(git rev-list --count HEAD)" "$(git rev-parse --short=7 HEAD)"
}

build() {
  cd ${srcdir}/${_realname}-${pkgver}

  export BUILD_MODE=prod
  export LIBRARY_TYPE=relocatable
  make lib
  make bin
}

package() {
  cd ${srcdir}/${_realname}-${pkgver}

  make install PREFIX=${pkgdir}${MINGW_PREFIX}
}

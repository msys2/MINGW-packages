_realname=lal-refactor
pkgbase=mingw-w64-${_realname}
pkgname=${MINGW_PACKAGE_PREFIX}-${_realname}
pkgver=24.0.r42.f1284f5
pkgrel=1
_branch='24.0'
source=("git+https://github.com/AdaCore/lal-refactor.git#branch=${_branch}")
sha256sums=('SKIP')
makedepends=("${MINGW_PACKAGE_PREFIX}-gcc-ada"
             "${MINGW_PACKAGE_PREFIX}-gprbuild")
depends=("${MINGW_PACKAGE_PREFIX}-adasat"
         "${MINGW_PACKAGE_PREFIX}-libvss"
         "${MINGW_PACKAGE_PREFIX}-libadalang")

pkgver() {
  cd ${_realname}
  printf "%s.r%s.%s" "$_branch" "$(git rev-list --count HEAD)" "$(git rev-parse --short=7 HEAD)"
}

build() {
  cd ${srcdir}/${_realname}

  export BUILD_MODE=prod
  export LIBRARY_TYPE=relocatable
  make lib
  make bin
}

package() {
  cd ${srcdir}/${_realname}

  make install PREFIX=${pkgdir}${MINGW_PREFIX}
}

--- a/CMakeLists.txt
+++ b/CMakeLists.txt
@@ -59,6 +59,10 @@ add_definitions(-DOPENSSL_API_COMPAT=0x10000000L)
 
 if(WIN32)
     add_definitions(-DWIN32_LEAN_AND_MEAN)
+    if(NOT MSVC)
+        # needed for BCRYPT_HMAC_SHA1_ALG_HANDLE in lib/internal.c
+        add_definitions(-D_WIN32_WINNT=_WIN32_WINNT_WIN10)
+    endif(NOT MSVC)
     set(_WIN32 ${WIN32})
 endif()
 

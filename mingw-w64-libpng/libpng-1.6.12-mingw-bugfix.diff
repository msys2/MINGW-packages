#  libpng 1.6.12 mingw bug fix patch.
#  Received from J. David Bryan - "mingw leptonica expert"
#
#  This patch is applied before building libpng.
#
#
#  Actions:
#
#   * The makefile creates an include file that contains an absolute path, which
#     cannot be resolved by gcc.  The patch alters the makefile to write just
#     the filename in the include file and then to add the absolute path to the
#     list of gcc include directories.  The latter will be resolved by make
#     before calling gcc.
#
#
#  Invoke as:
#
#   patch -p1 -d /usr/local/src/libpng-1.6.12 -i /opt/utilities/patches/libpng-1.6.12-mingw-bugfix.diff


diff -u -r -N original/Makefile.in patched/Makefile.in
--- original/Makefile.in	2014-06-11 21:35:29 -0400
+++ patched/Makefile.in	2014-07-04 17:05:36 -0400
@@ -2142,8 +2142,8 @@
 .dfn.out:
 	rm -f $@ $*.c $*.tf[12]
 	test -d scripts || mkdir scripts || test -d scripts
-	echo '#include "$<"' >$*.c
-	$(DFNCPP) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES)\
+	echo '#include "$(<F)"' >$*.c
+	$(DFNCPP) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) -I$(<D)\
 	    $(CPPFLAGS) $(SYMBOL_CFLAGS) $*.c > $*.tf1
 	$(AWK) -f "${srcdir}/scripts/dfn.awk" out="$*.tf2" $*.tf1 1>&2
 	rm -f $*.c $*.tf1

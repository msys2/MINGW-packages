# Maintainer: Your Name <your.email@example.com>
_realname=wnu-binutils
pkgbase=mingw-w64-${_realname}
MINGW_ARCH=mingw64
pkgname="${MINGW_PACKAGE_PREFIX}-${_realname}"
pkgver=1.0.1
pkgrel=1
pkgdesc="WNU Binutils - Assembler and linker for Windows native development (mingw-w64)"
arch=('any')
mingw_arch=('mingw64' 'ucrt64' 'clang64' 'clangarm64')
url="https://gitlab.com/wnu-project/wnu-binutils"
license=('spdx:MIT')
depends=("${MINGW_PACKAGE_PREFIX}-gcc-libs")
makedepends=("${MINGW_PACKAGE_PREFIX}-cc")
source=("${_realname}-${pkgver}.tar.gz::https://gitlab.com/wnu-project/wnu-binutils/-/archive/v${pkgver}/wnu-binutils-v${pkgver}.tar.gz")
sha256sums=('SKIP')  # Replace with actual checksum

build() {
  cd "${srcdir}/${_realname}-v${pkgver}/1.x.x/1.0.x/1.0.0"
  make all nm CC="${MINGW_PREFIX}/bin/gcc"
}

check() {
  cd "${srcdir}/${_realname}-v${pkgver}/1.x.x/1.0.x/1.0.0"
  # Add tests here if available
  # make test
}

package() {
  cd "${srcdir}/${_realname}-v${pkgver}/1.x.x/1.0.x/1.0.0"
  
  # Install binaries from bin/ directory
  install -Dm755 bin/wnu-as.exe "${pkgdir}${MINGW_PREFIX}/bin/wnu-as.exe"
  install -Dm755 bin/wnu-ld.exe "${pkgdir}${MINGW_PREFIX}/bin/wnu-ld.exe"
  install -Dm755 bin/wnu-objcopy.exe "${pkgdir}${MINGW_PREFIX}/bin/wnu-objcopy.exe"
  install -Dm755 bin/wnu-nm.exe "${pkgdir}${MINGW_PREFIX}/bin/wnu-nm.exe"
  
  # Install WNU Assembly compiler
  cd "${srcdir}/${_realname}-v${pkgver}/wnu-assembly"
  if [ -f bin/wnu-wasc.exe ]; then
    install -Dm755 bin/wnu-wasc.exe "${pkgdir}${MINGW_PREFIX}/bin/wnu-wasc.exe"
  fi
  
  # Install documentation
  cd "${srcdir}/${_realname}-v${pkgver}"
  install -Dm644 README.md "${pkgdir}${MINGW_PREFIX}/share/doc/${_realname}/README.md"
  install -Dm644 CHANGELOG.md "${pkgdir}${MINGW_PREFIX}/share/doc/${_realname}/CHANGELOG.md"
  
  # Install license if it exists
  if [ -f LICENSE ]; then
    install -Dm644 LICENSE.txt "${pkgdir}${MINGW_PREFIX}/share/licenses/${_realname}/LICENSE.txt"
  fi
}

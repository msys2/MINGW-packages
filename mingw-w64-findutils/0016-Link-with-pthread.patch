From 856ce0a24f90572fa7eaca3f5bc736cc59840ad3 Mon Sep 17 00:00:00 2001
From: Cyril Arnould <cyril.arnould@outlook.com>
Date: Wed, 14 Jun 2023 00:52:03 +0200
Subject: [PATCH 16/17] Link with pthread

Otherwise the clang builds fail
---
 find/Makefile.am   | 2 ++
 locate/Makefile.am | 2 ++
 xargs/Makefile.am  | 1 +
 3 files changed, 5 insertions(+)

diff --git a/find/Makefile.am b/find/Makefile.am
index bf2540d3..0f20c7af 100644
--- a/find/Makefile.am
+++ b/find/Makefile.am
@@ -26,6 +26,8 @@ bin_PROGRAMS     = find
 find_SOURCES     = ftsfind.c
 man_MANS         = find.1
 
+find_LDFLAGS     = -pthread
+
 EXTRA_DIST = defs.h sharefile.h print.h $(man_MANS)
 AM_CPPFLAGS = -I../gl/lib -I$(top_srcdir)/lib -I$(top_srcdir)/gl/lib -DLOCALEDIR=\"$(localedir)\"
 LDADD = libfindtools.a ../lib/libfind.a ../gl/lib/libgnulib.a $(LIBINTL) $(LIB_CLOCK_GETTIME) $(LIB_EACCESS) $(LIB_SELINUX) $(LIB_CLOSE) $(MODF_LIBM) $(FINDLIBS) $(GETHOSTNAME_LIB) $(LIB_EACCESS) $(LIB_SETLOCALE_NULL) $(LIB_MBRTOWC)
diff --git a/locate/Makefile.am b/locate/Makefile.am
index 05b9c7c5..bd461a32 100644
--- a/locate/Makefile.am
+++ b/locate/Makefile.am
@@ -33,6 +33,8 @@ DISTCLEANFILES = dblocation.texi
 locate_SOURCES = locate.c word_io.c
 nodist_locate_TEXINFOS = dblocation.texi
 
+locate_LDFLAGS = -pthread
+
 AM_CPPFLAGS = -I$(top_srcdir)/lib -I../gl/lib -I$(top_srcdir)/gl/lib -DLOCATE_DB=\"$(LOCATE_DB)\" -DLOCALEDIR=\"$(localedir)\"
 
 LDADD = ../lib/libfind.a ../gl/lib/libgnulib.a $(LIB_CLOSE) $(LIBINTL) $(LIB_SETLOCALE_NULL) $(LIB_MBRTOWC)
diff --git a/xargs/Makefile.am b/xargs/Makefile.am
index a103c29d..d328daf7 100644
--- a/xargs/Makefile.am
+++ b/xargs/Makefile.am
@@ -18,6 +18,7 @@ AM_CFLAGS = $(WARN_CFLAGS)
 localedir = $(datadir)/locale
 bin_PROGRAMS = xargs
 man_MANS = xargs.1
+xargs_LDFLAGS = -pthread
 AM_CPPFLAGS = -I.. -I../gl/lib -I$(top_srcdir)/gl/lib -I$(top_srcdir)/lib -DLOCALEDIR=\"$(localedir)\"
 LDADD = ../lib/libfind.a ../gl/lib/libgnulib.a $(LIB_CLOSE) $(LIBINTL) $(LIB_SETLOCALE_NULL) $(LIB_MBRTOWC) $(LIB_POLL)
 EXTRA_DIST = $(man_MANS)
-- 
2.41.0


--- a/gnulib-tests/Makefile.am
+++ b/gnulib-tests/Makefile.am
@@ -1093,7 +1093,7 @@
 ## begin gnulib module localcharset-tests
 
 noinst_PROGRAMS += test-localcharset
-test_localcharset_LDADD = $(LDADD) $(LIB_SETLOCALE)
+test_localcharset_LDADD = $(LDADD) $(LIB_SETLOCALE) -lwinpthread
 EXTRA_DIST += test-localcharset.c
 
 ## end   gnulib module localcharset-tests

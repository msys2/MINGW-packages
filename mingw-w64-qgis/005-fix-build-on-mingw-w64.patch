--- a/CMakeLists.txt
+++ b/CMakeLists.txt
@@ -423,10 +423,10 @@
   #############################################################
   # search for dependencies
 
-  if(NOT WIN32 AND NOT ANDROID)
+  if(NOT MSVC AND NOT ANDROID)
     include(CheckFunctionExists)
     CHECK_FUNCTION_EXISTS(openpty OPENPTY_IN_LIBC)
-    if(NOT OPENPTY_IN_LIBC)
+    if(UNIX AND NOT OPENPTY_IN_LIBC)
       set(CMAKE_REQUIRED_INCLUDES util.h)
       set(CMAKE_REQUIRED_LIBRARIES util)
       CHECK_FUNCTION_EXISTS(openpty NEED_LIBUTIL)

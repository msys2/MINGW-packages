From f47b04a51e3ad676e28dffe4b28ef77c75b500ca Mon Sep 17 00:00:00 2001
From: Karl Berry <karl@freefriends.org>
Date: Wed, 3 Nov 2021 22:47:27 +0000
Subject: [PATCH] [w32] use libtool to install intended .exe, not libtool
 wrapper

git-svn-id: svn://tug.org/texlive/trunk/Build/source@60940 c570f23f-e606-0410-a88d-b1316a301751
---
 texk/dvipdfm-x/Makefile.am        | 4 +++-
 texk/dvipdfm-x/Makefile.in        | 9 +++++----
 texk/web2c/Makefile.in            | 4 ++--
 texk/web2c/am/texmf.am            | 6 +++---
 texk/web2c/omegafonts/ChangeLog   | 6 ++++++
 texk/web2c/omegafonts/Makefile.am | 7 +++++--
 texk/web2c/omegafonts/Makefile.in | 3 ++-
 7 files changed, 26 insertions(+), 13 deletions(-)

diff --git a/texk/dvipdfm-x/Makefile.am b/texk/dvipdfm-x/Makefile.am
index 6c845232ab..6d9f2b8563 100644
--- a/texk/dvipdfm-x/Makefile.am
+++ b/texk/dvipdfm-x/Makefile.am
@@ -1,6 +1,7 @@
 ## Makefile.am for the TeX Live subdirectory texk/dvipdfm-x/
 ##
-## Copyright (C) 2009-2015 Peter Breitenlohner <tex-live@tug.org>
+## Copyright 2015-2021 Karl Berry <tex-live@tug.org>
+## Copyright 2009-2015 Peter Breitenlohner <tex-live@tug.org>
 ## You may freely use, modify and/or distribute this file.
 ##
 bin_PROGRAMS = xdvipdfmx
@@ -209,6 +210,7 @@ dist_cmapdata_DATA = data/EUC-UCS2
 
 install-exec-hook: install-bin-links
 if WIN32
+# same install happens in web2c/omegafonts.
 	$(INSTALL_PROGRAM_ENV) $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL_PROGRAM) call_xdvipdfmx$(EXEEXT) "$(DESTDIR)$(bindir)/dvipdfm$(EXEEXT)"
 	$(INSTALL_PROGRAM_ENV) $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL_PROGRAM) call_xdvipdfmx$(EXEEXT) "$(DESTDIR)$(bindir)/dvipdfmx$(EXEEXT)"
 	$(INSTALL_PROGRAM_ENV) $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL_PROGRAM) call_xdvipdfmx$(EXEEXT) "$(DESTDIR)$(bindir)/ebb$(EXEEXT)"
diff --git a/texk/dvipdfm-x/Makefile.in b/texk/dvipdfm-x/Makefile.in
index 28dbd24b64..84838f479e 100644
--- a/texk/dvipdfm-x/Makefile.in
+++ b/texk/dvipdfm-x/Makefile.in
@@ -2002,10 +2002,11 @@ uninstall-man1-links:
 	done
 
 install-exec-hook: install-bin-links
-@WIN32_TRUE@	$(INSTALL_PROGRAM) call_xdvipdfmx$(EXEEXT) $(DESTDIR)$(bindir)/dvipdfm$(EXEEXT)
-@WIN32_TRUE@	$(INSTALL_PROGRAM) call_xdvipdfmx$(EXEEXT) $(DESTDIR)$(bindir)/dvipdfmx$(EXEEXT)
-@WIN32_TRUE@	$(INSTALL_PROGRAM) call_xdvipdfmx$(EXEEXT) $(DESTDIR)$(bindir)/ebb$(EXEEXT)
-@WIN32_TRUE@	$(INSTALL_PROGRAM) call_xdvipdfmx$(EXEEXT) $(DESTDIR)$(bindir)/extractbb$(EXEEXT)
+# same install happens in web2c/omegafonts.
+@WIN32_TRUE@	$(INSTALL_PROGRAM_ENV) $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL_PROGRAM) call_xdvipdfmx$(EXEEXT) "$(DESTDIR)$(bindir)/dvipdfm$(EXEEXT)"
+@WIN32_TRUE@	$(INSTALL_PROGRAM_ENV) $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL_PROGRAM) call_xdvipdfmx$(EXEEXT) "$(DESTDIR)$(bindir)/dvipdfmx$(EXEEXT)"
+@WIN32_TRUE@	$(INSTALL_PROGRAM_ENV) $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL_PROGRAM) call_xdvipdfmx$(EXEEXT) "$(DESTDIR)$(bindir)/ebb$(EXEEXT)"
+@WIN32_TRUE@	$(INSTALL_PROGRAM_ENV) $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL_PROGRAM) call_xdvipdfmx$(EXEEXT) "$(DESTDIR)$(bindir)/extractbb$(EXEEXT)"
 
 install-data-hook: install-man1-links
 
diff --git a/texk/web2c/Makefile.in b/texk/web2c/Makefile.in
index e623bd7fdd..a9fbc6a36b 100644
--- a/texk/web2c/Makefile.in
+++ b/texk/web2c/Makefile.in
@@ -21238,8 +21238,8 @@ trip-clean:
 
 .PHONY: install-mf-links uninstall-mf-links
 @WIN32_TRUE@install-mf-links: call_mf$(EXEEXT)
-@MFN_FALSE@@WIN32_TRUE@	$(INSTALL_PROGRAM) call_mf$(EXEEXT) $(DESTDIR)$(bindir)/mf-nowin$(EXEEXT)
-@WIN32_TRUE@	$(INSTALL_PROGRAM) call_mf$(EXEEXT) $(DESTDIR)$(bindir)/inimf$(EXEEXT)
+@MFN_FALSE@@WIN32_TRUE@	$(INSTALL_PROGRAM_ENV) $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL_PROGRAM) call_mf$(EXEEXT) "$(DESTDIR)$(bindir)/mf-nowin$(EXEEXT)"
+@WIN32_TRUE@	$(INSTALL_PROGRAM_ENV) $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL_PROGRAM) call_mf$(EXEEXT) "$(DESTDIR)$(bindir)/inimf$(EXEEXT)"
 @WIN32_TRUE@uninstall-mf-links:
 @MFN_FALSE@@WIN32_TRUE@	rm -f $(DESTDIR)$(bindir)/mf-nowin$(EXEEXT)
 @WIN32_TRUE@	rm -f $(DESTDIR)$(bindir)/inimf$(EXEEXT)
diff --git a/texk/web2c/am/texmf.am b/texk/web2c/am/texmf.am
index d4fe9c515f..33b99ecdef 100644
--- a/texk/web2c/am/texmf.am
+++ b/texk/web2c/am/texmf.am
@@ -1,7 +1,7 @@
 ## $Id$
 ## texk/web2c/am/texmf.am: Makefile fragment for TeX and MF.
 ##
-## Copyright 2015-2019 Karl Berry <tex-live@tug.org>
+## Copyright 2015-2021 Karl Berry <tex-live@tug.org>
 ## Copyright 2009-2015 Peter Breitenlohner <tex-live@tug.org>
 ## You may freely use, modify and/or distribute this file.
 
@@ -128,9 +128,9 @@ call_mf_LDADD =
 if WIN32
 install-mf-links: call_mf$(EXEEXT)
 if !MFN
-	$(INSTALL_PROGRAM) call_mf$(EXEEXT) $(DESTDIR)$(bindir)/mf-nowin$(EXEEXT)
+	$(INSTALL_PROGRAM_ENV) $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL_PROGRAM) call_mf$(EXEEXT) "$(DESTDIR)$(bindir)/mf-nowin$(EXEEXT)"
 endif !MFN
-	$(INSTALL_PROGRAM) call_mf$(EXEEXT) $(DESTDIR)$(bindir)/inimf$(EXEEXT)
+	$(INSTALL_PROGRAM_ENV) $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL_PROGRAM) call_mf$(EXEEXT) "$(DESTDIR)$(bindir)/inimf$(EXEEXT)"
 uninstall-mf-links:
 if !MFN
 	rm -f $(DESTDIR)$(bindir)/mf-nowin$(EXEEXT)
diff --git a/texk/web2c/omegafonts/ChangeLog b/texk/web2c/omegafonts/ChangeLog
index c0c111637f..fbfae89c95 100644
--- a/texk/web2c/omegafonts/ChangeLog
+++ b/texk/web2c/omegafonts/ChangeLog
@@ -1,3 +1,9 @@
+2021-11-03  Karl Berry  <karl@freefriends.org>
+
+	* Makefile.am (install-exec-hook) [WIN32]: install via libtool,
+	the same change as made for dvipdfmx.
+	https://tug.org/pipermail/dvipdfmx/2021-October/000301.html
+
 2020-12-04  Karl Berry  <karl@freefriends.org>
 
 	* pl-lexer.l (YY_BUF_SIZE): #define 110000, for the same
diff --git a/texk/web2c/omegafonts/Makefile.am b/texk/web2c/omegafonts/Makefile.am
index b39f11f3c8..2be88e0437 100644
--- a/texk/web2c/omegafonts/Makefile.am
+++ b/texk/web2c/omegafonts/Makefile.am
@@ -1,6 +1,8 @@
+## $Id$
 ## Makefile.am for the TeX Live subdirectory texk/web2c/omegafonts/
 ##
-## Copyright (C) 2009-2015 Peter Breitenlohner <tex-live@tug.org>
+## Copyright 2015-2021 Karl Berry <tex-live@tug.org>
+## Copyright 2009-2015 Peter Breitenlohner <tex-live@tug.org>
 ## You may freely use, modify and/or distribute this file.
 ##
 AM_CPPFLAGS =  -I$(top_builddir)/.. -I$(top_srcdir) $(KPATHSEA_INCLUDES) -DNOT_WEB2C
@@ -82,8 +84,9 @@ include $(top_srcdir)/../../am/bin_links.am
 if OTANGLE
 install-exec-hook: install-bin-links
 if WIN32
+# same install happens in dvipdfmx.
 	for f in $(linked_programs); do \
-	  $(INSTALL_PROGRAM) call_omfonts$(EXEEXT) $(DESTDIR)$(bindir)/$$f$(EXEEXT) || exit 1; \
+	  $(INSTALL_PROGRAM_ENV) $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL_PROGRAM) call_omfonts$(EXEEXT) "$(DESTDIR)$(bindir)/$$f$(EXEEXT)"
 	done
 endif WIN32
 uninstall-hook: uninstall-bin-links
diff --git a/texk/web2c/omegafonts/Makefile.in b/texk/web2c/omegafonts/Makefile.in
index 5dece2ff2a..ed1e6ba7a7 100644
--- a/texk/web2c/omegafonts/Makefile.in
+++ b/texk/web2c/omegafonts/Makefile.in
@@ -1424,8 +1424,9 @@ uninstall-bin-links:
 @WIN32_FALSE@	done
 
 @OTANGLE_TRUE@install-exec-hook: install-bin-links
+# same install happens in dvipdfmx.
 @OTANGLE_TRUE@@WIN32_TRUE@	for f in $(linked_programs); do \
-@OTANGLE_TRUE@@WIN32_TRUE@	  $(INSTALL_PROGRAM) call_omfonts$(EXEEXT) $(DESTDIR)$(bindir)/$$f$(EXEEXT) || exit 1; \
+@OTANGLE_TRUE@@WIN32_TRUE@	  $(INSTALL_PROGRAM_ENV) $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL_PROGRAM) call_omfonts$(EXEEXT) "$(DESTDIR)$(bindir)/$$f$(EXEEXT)"
 @OTANGLE_TRUE@@WIN32_TRUE@	done
 @OTANGLE_TRUE@uninstall-hook: uninstall-bin-links
 @OTANGLE_TRUE@@WIN32_TRUE@	for f in $(linked_programs); do \

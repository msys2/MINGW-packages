From 98819905aad97d8643656c464c188f1e7d34cb98 Mon Sep 17 00:00:00 2001
From: taozuhong <taozuhong@gmail.com>
Date: Sat, 9 Jan 2021 14:09:10 +0800
Subject: [PATCH 1/3] add MSYS2 compile support

---
 Makefile | 9 ++++++++-
 1 file changed, 8 insertions(+), 1 deletion(-)

diff --git a/Makefile b/Makefile
index a8d37a2eb..5463b56c8 100644
--- a/Makefile
+++ b/Makefile
@@ -4,7 +4,7 @@
 # This file is released under the BSD license, see the COPYING file
 
 OBJ=alloc.o net.o hiredis.o sds.o async.o read.o sockcompat.o
-SSL_OBJ=ssl.o
+SSL_OBJ=alloc.o net.o hiredis.o sds.o async.o read.o sockcompat.o ssl.o
 EXAMPLES=hiredis-example hiredis-example-libevent hiredis-example-libev hiredis-example-glib hiredis-example-push
 ifeq ($(USE_SSL),1)
 EXAMPLES+=hiredis-example-ssl hiredis-example-libevent-ssl
@@ -84,6 +84,13 @@ else
   SSL_LDFLAGS+=-L$(OPENSSL_PREFIX)/lib -lssl -lcrypto
 endif
 
+ifeq ($(findstring MINGW64,$(uname_S)),MINGW64)
+  OPENSSL_PREFIX?=/mingw64
+  CFLAGS+=-I$(OPENSSL_PREFIX)/include/openssl
+  REAL_LDFLAGS+= -lwsock32 -lws2_32
+  SSL_LDFLAGS+=-L$(OPENSSL_PREFIX)/lib -lssl -lcrypto -lcrypt32
+endif
+
 ifeq ($(uname_S),SunOS)
   IS_SUN_CC=$(shell sh -c '$(CC) -V 2>&1 |egrep -i -c "sun|studio"')
   ifeq ($(IS_SUN_CC),1)

From 1c44b4d2b2b95045afcf038f16009972098956cd Mon Sep 17 00:00:00 2001
From: taozuhong <taozuhong@gmail.com>
Date: Sat, 9 Jan 2021 14:37:54 +0800
Subject: [PATCH 2/3] add windows library support

---
 Makefile | 4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

diff --git a/Makefile b/Makefile
index 5463b56c8..a3163fed8 100644
--- a/Makefile
+++ b/Makefile
@@ -50,8 +50,8 @@ DEBUG_FLAGS?= -g -ggdb
 REAL_CFLAGS=$(OPTIMIZATION) -fPIC $(CPPFLAGS) $(CFLAGS) $(WARNINGS) $(DEBUG_FLAGS)
 REAL_LDFLAGS=$(LDFLAGS)
 
-DYLIBSUFFIX=so
-STLIBSUFFIX=a
+DYLIBSUFFIX=$(if $(WINDIR),dll,so)
+STLIBSUFFIX=$(if $(WINDIR),lib,a)
 DYLIB_MINOR_NAME=$(LIBNAME).$(DYLIBSUFFIX).$(HIREDIS_SONAME)
 DYLIB_MAJOR_NAME=$(LIBNAME).$(DYLIBSUFFIX).$(HIREDIS_MAJOR)
 DYLIBNAME=$(LIBNAME).$(DYLIBSUFFIX)

From 5217652877f471136191b060984a3cfb79af3cb9 Mon Sep 17 00:00:00 2001
From: taozuhong <taozuhong@gmail.com>
Date: Sat, 9 Jan 2021 15:52:49 +0800
Subject: [PATCH 3/3] MSYS2 32 & 64 bit support

---
 Makefile | 6 +++---
 1 file changed, 3 insertions(+), 3 deletions(-)

diff --git a/Makefile b/Makefile
index a3163fed8..c644a5595 100644
--- a/Makefile
+++ b/Makefile
@@ -84,11 +84,11 @@ else
   SSL_LDFLAGS+=-L$(OPENSSL_PREFIX)/lib -lssl -lcrypto
 endif
 
-ifeq ($(findstring MINGW64,$(uname_S)),MINGW64)
-  OPENSSL_PREFIX?=/mingw64
+ifeq ($(findstring MINGW,$(uname_S)),MINGW)
+  OPENSSL_PREFIX?=$(MINGW_PREFIX)
   CFLAGS+=-I$(OPENSSL_PREFIX)/include/openssl
   REAL_LDFLAGS+= -lwsock32 -lws2_32
-  SSL_LDFLAGS+=-L$(OPENSSL_PREFIX)/lib -lssl -lcrypto -lcrypt32
+  SSL_LDFLAGS+=-L$(OPENSSL_PREFIX)/lib -lssl -lcrypto
 endif
 
 ifeq ($(uname_S),SunOS)
